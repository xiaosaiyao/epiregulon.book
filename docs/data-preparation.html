<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Data preparation | Epiregulon documentation</title>
  <meta name="description" content="<p>This book presents the Epiregulon package. We provide the tutorials showing different
scenarions in which the package can be usd to analyse single-cell data.</p>" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Data preparation | Epiregulon documentation" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This book presents the Epiregulon package. We provide the tutorials showing different
scenarions in which the package can be usd to analyse single-cell data.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Data preparation | Epiregulon documentation" />
  
  <meta name="twitter:description" content="<p>This book presents the Epiregulon package. We provide the tutorials showing different
scenarions in which the package can be usd to analyse single-cell data.</p>" />
  

<meta name="author" content="Xiaosai Yao, Tomasz Włodarczyk" />


<meta name="date" content="2025-01-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="installation.html"/>
<link rel="next" href="basic-workflow-with-multiassayexperiment.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Epiregulon documentation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>1</b> Installation</a>
<ul>
<li class="chapter" data-level="1.1" data-path="installation.html"><a href="installation.html#installing-from-github"><i class="fa fa-check"></i><b>1.1</b> Installing from github</a></li>
<li class="chapter" data-level="1.2" data-path="installation.html"><a href="installation.html#installing-from-bioconductor"><i class="fa fa-check"></i><b>1.2</b> Installing from Bioconductor</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-preparation.html"><a href="data-preparation.html"><i class="fa fa-check"></i><b>2</b> Data preparation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-preparation.html"><a href="data-preparation.html#constructing-a-singlecellexperiment-object"><i class="fa fa-check"></i><b>2.1</b> Constructing a SingleCellExperiment object</a></li>
<li class="chapter" data-level="2.2" data-path="data-preparation.html"><a href="data-preparation.html#starting-from-an-archr-object"><i class="fa fa-check"></i><b>2.2</b> Starting from an ArchR object</a></li>
<li class="chapter" data-level="2.3" data-path="data-preparation.html"><a href="data-preparation.html#starting-from-a-seuratsignac-object"><i class="fa fa-check"></i><b>2.3</b> Starting from a Seurat/Signac object</a></li>
<li class="chapter" data-level="2.4" data-path="data-preparation.html"><a href="data-preparation.html#starting-from-anndata"><i class="fa fa-check"></i><b>2.4</b> Starting from AnnData</a></li>
<li class="chapter" data-level="2.5" data-path="data-preparation.html"><a href="data-preparation.html#starting-from-10x-data-formats"><i class="fa fa-check"></i><b>2.5</b> Starting from 10x data formats</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="data-preparation.html"><a href="data-preparation.html#reading-from-.h5-file"><i class="fa fa-check"></i><b>2.5.1</b> Reading from .h5 file</a></li>
<li class="chapter" data-level="2.5.2" data-path="data-preparation.html"><a href="data-preparation.html#reading-directly-from-a-10x-directory"><i class="fa fa-check"></i><b>2.5.2</b> Reading directly from a 10x directory</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="data-preparation.html"><a href="data-preparation.html#reading-directly-from-csv"><i class="fa fa-check"></i><b>2.6</b> Reading directly from CSV</a></li>
<li class="chapter" data-level="2.7" data-path="data-preparation.html"><a href="data-preparation.html#important-points"><i class="fa fa-check"></i><b>2.7</b> Important points</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html"><i class="fa fa-check"></i><b>3</b> Basic workflow with MultiAssayExperiment</a>
<ul>
<li class="chapter" data-level="3.1" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#data-preparation-1"><i class="fa fa-check"></i><b>3.1</b> Data preparation</a></li>
<li class="chapter" data-level="3.2" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#quick-start"><i class="fa fa-check"></i><b>3.2</b> Quick start</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#retrieve-bulk-tf-chip-seq-binding-sites"><i class="fa fa-check"></i><b>3.2.1</b> Retrieve bulk TF ChIP-seq binding sites</a></li>
<li class="chapter" data-level="3.2.2" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#link-atac-seq-peaks-to-target-genes"><i class="fa fa-check"></i><b>3.2.2</b> Link ATAC-seq peaks to target genes</a></li>
<li class="chapter" data-level="3.2.3" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#add-tf-motif-binding-to-peaks"><i class="fa fa-check"></i><b>3.2.3</b> Add TF motif binding to peaks</a></li>
<li class="chapter" data-level="3.2.4" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#generate-regulons"><i class="fa fa-check"></i><b>3.2.4</b> Generate regulons</a></li>
<li class="chapter" data-level="3.2.5" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#network-pruning-highly-recommended"><i class="fa fa-check"></i><b>3.2.5</b> Network pruning (highly recommended)</a></li>
<li class="chapter" data-level="3.2.6" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#add-weights"><i class="fa fa-check"></i><b>3.2.6</b> Add Weights</a></li>
<li class="chapter" data-level="3.2.7" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#optional-annotate-with-tf-motifs"><i class="fa fa-check"></i><b>3.2.7</b> (Optional) Annotate with TF motifs</a></li>
<li class="chapter" data-level="3.2.8" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#calculate-tf-activity"><i class="fa fa-check"></i><b>3.2.8</b> Calculate TF activity</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#session-info"><i class="fa fa-check"></i><b>3.3</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html"><i class="fa fa-check"></i><b>4</b> Advanced workflow with MultiAssayExperiment</a>
<ul>
<li class="chapter" data-level="4.1" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#data-preparation-2"><i class="fa fa-check"></i><b>4.1</b> Data preparation</a></li>
<li class="chapter" data-level="4.2" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#retrieve-bulk-tf-chip-seq-binding-sites-1"><i class="fa fa-check"></i><b>4.2</b> Retrieve bulk TF ChIP-seq binding sites</a></li>
<li class="chapter" data-level="4.3" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#link-atacseq-peaks-to-target-genes"><i class="fa fa-check"></i><b>4.3</b> Link ATACseq peaks to target genes</a></li>
<li class="chapter" data-level="4.4" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#add-tf-motif-binding-to-peaks-1"><i class="fa fa-check"></i><b>4.4</b> Add TF motif binding to peaks</a></li>
<li class="chapter" data-level="4.5" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#generate-regulons-1"><i class="fa fa-check"></i><b>4.5</b> Generate regulons</a></li>
<li class="chapter" data-level="4.6" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#prune-network"><i class="fa fa-check"></i><b>4.6</b> Prune network</a></li>
<li class="chapter" data-level="4.7" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#add-weights-1"><i class="fa fa-check"></i><b>4.7</b> Add Weights</a></li>
<li class="chapter" data-level="4.8" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#calculate-tf-activity-1"><i class="fa fa-check"></i><b>4.8</b> Calculate TF activity</a></li>
<li class="chapter" data-level="4.9" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#differential-tf-activity-test"><i class="fa fa-check"></i><b>4.9</b> Differential TF activity test</a></li>
<li class="chapter" data-level="4.10" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#visualizing-tf-activities"><i class="fa fa-check"></i><b>4.10</b> Visualizing TF activities</a></li>
<li class="chapter" data-level="4.11" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#geneset-enrichment"><i class="fa fa-check"></i><b>4.11</b> Geneset enrichment</a></li>
<li class="chapter" data-level="4.12" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#differential-network-analysis"><i class="fa fa-check"></i><b>4.12</b> Differential Network analysis</a></li>
<li class="chapter" data-level="4.13" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#session-info-1"><i class="fa fa-check"></i><b>4.13</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html"><i class="fa fa-check"></i><b>5</b> ArchR workflow and different weight methods</a>
<ul>
<li class="chapter" data-level="5.1" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#data-preparation-3"><i class="fa fa-check"></i><b>5.1</b> Data preparation</a></li>
<li class="chapter" data-level="5.2" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#load-archr-project"><i class="fa fa-check"></i><b>5.2</b> Load ArchR project</a></li>
<li class="chapter" data-level="5.3" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#retrieve-matrices-from-archr-project"><i class="fa fa-check"></i><b>5.3</b> Retrieve matrices from ArchR project</a></li>
<li class="chapter" data-level="5.4" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#retrieve-bulk-tf-chip-seq-binding-sites-2"><i class="fa fa-check"></i><b>5.4</b> Retrieve bulk TF ChIP-seq binding sites</a></li>
<li class="chapter" data-level="5.5" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#link-atac-seq-peaks-to-target-genes-1"><i class="fa fa-check"></i><b>5.5</b> Link ATAC-seq peaks to target genes</a></li>
<li class="chapter" data-level="5.6" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#add-tf-motif-binding-to-peaks-2"><i class="fa fa-check"></i><b>5.6</b> Add TF motif binding to peaks</a></li>
<li class="chapter" data-level="5.7" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#generate-regulons-2"><i class="fa fa-check"></i><b>5.7</b> Generate regulons</a></li>
<li class="chapter" data-level="5.8" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#optional-annotate-with-tf-motifs-1"><i class="fa fa-check"></i><b>5.8</b> (Optional) Annotate with TF motifs</a></li>
<li class="chapter" data-level="5.9" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#prune-network-1"><i class="fa fa-check"></i><b>5.9</b> Prune network</a></li>
<li class="chapter" data-level="5.10" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#add-weights-2"><i class="fa fa-check"></i><b>5.10</b> Add Weights</a></li>
<li class="chapter" data-level="5.11" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#calculate-tf-activity-2"><i class="fa fa-check"></i><b>5.11</b> Calculate TF activity</a></li>
<li class="chapter" data-level="5.12" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#perform-differential-activity"><i class="fa fa-check"></i><b>5.12</b> Perform differential activity</a></li>
<li class="chapter" data-level="5.13" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#visualize-the-results"><i class="fa fa-check"></i><b>5.13</b> Visualize the results</a></li>
<li class="chapter" data-level="5.14" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#differential-network-analysis-1"><i class="fa fa-check"></i><b>5.14</b> Differential network analysis</a></li>
<li class="chapter" data-level="5.15" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#session-info-2"><i class="fa fa-check"></i><b>5.15</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="single-modality-scrna-seq-only.html"><a href="single-modality-scrna-seq-only.html"><i class="fa fa-check"></i><b>6</b> Single modality: scRNA-seq only</a>
<ul>
<li class="chapter" data-level="6.1" data-path="single-modality-scrna-seq-only.html"><a href="single-modality-scrna-seq-only.html#load-regulon"><i class="fa fa-check"></i><b>6.1</b> Load regulon</a></li>
<li class="chapter" data-level="6.2" data-path="single-modality-scrna-seq-only.html"><a href="single-modality-scrna-seq-only.html#load-scrna-seq-data"><i class="fa fa-check"></i><b>6.2</b> Load scRNA-seq data</a></li>
<li class="chapter" data-level="6.3" data-path="single-modality-scrna-seq-only.html"><a href="single-modality-scrna-seq-only.html#calculate-activity"><i class="fa fa-check"></i><b>6.3</b> Calculate activity</a></li>
<li class="chapter" data-level="6.4" data-path="single-modality-scrna-seq-only.html"><a href="single-modality-scrna-seq-only.html#perform-differential-activity-1"><i class="fa fa-check"></i><b>6.4</b> Perform differential activity</a></li>
<li class="chapter" data-level="6.5" data-path="single-modality-scrna-seq-only.html"><a href="single-modality-scrna-seq-only.html#visualize-activity"><i class="fa fa-check"></i><b>6.5</b> Visualize activity</a></li>
<li class="chapter" data-level="6.6" data-path="single-modality-scrna-seq-only.html"><a href="single-modality-scrna-seq-only.html#pathway-enrichment"><i class="fa fa-check"></i><b>6.6</b> Pathway enrichment</a></li>
<li class="chapter" data-level="6.7" data-path="single-modality-scrna-seq-only.html"><a href="single-modality-scrna-seq-only.html#session-info-3"><i class="fa fa-check"></i><b>6.7</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="contact.html"><a href="contact.html"><i class="fa fa-check"></i><b>7</b> Contact</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Epiregulon documentation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-preparation" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Data preparation<a href="data-preparation.html#data-preparation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Epiregulon operates on the <code>SingleCellExperiment</code> class. We assume that gene expression, chromatin accessibility and dimension reduction have been obtained by users’ favorite packages prior to the use of Epiregulon. This chapter provides instructions on how to convert gene expression matrix and peak matrix into <code>SingleCellExperiment</code> objects from other formats including ArchR project, Seurat objects, AnnData and 10x genomics output. The first section provides a quick primer on the components of a <code>SingleCellExperiment</code> object necessary to run Epiregulon. It is thus recommended for all users to go through it.</p>
<div id="constructing-a-singlecellexperiment-object" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Constructing a SingleCellExperiment object<a href="data-preparation.html#constructing-a-singlecellexperiment-object" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s construct a GeneExpressionMatrix from scratch. First we will create the count matrix.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="data-preparation.html#cb5-1" tabindex="-1"></a><span class="fu">library</span>(SingleCellExperiment)</span>
<span id="cb5-2"><a href="data-preparation.html#cb5-2" tabindex="-1"></a>counts <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rpois</span>(<span class="dv">100000</span>, <span class="at">lambda =</span> <span class="dv">2</span>), <span class="at">ncol=</span><span class="dv">1000</span>, <span class="at">nrow=</span><span class="dv">100</span>)</span>
<span id="cb5-3"><a href="data-preparation.html#cb5-3" tabindex="-1"></a>GeneExpressionMatrix <span class="ot">&lt;-</span> <span class="fu">SingleCellExperiment</span>(<span class="fu">list</span>(<span class="at">counts=</span>counts))</span>
<span id="cb5-4"><a href="data-preparation.html#cb5-4" tabindex="-1"></a><span class="fu">rownames</span>(GeneExpressionMatrix) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Gene&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">sep=</span><span class="st">&quot;-&quot;</span>)</span>
<span id="cb5-5"><a href="data-preparation.html#cb5-5" tabindex="-1"></a><span class="fu">colnames</span>(GeneExpressionMatrix) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Cell&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">sep=</span><span class="st">&quot;-&quot;</span>)</span></code></pre></div>
<p>It is important (and efficient) to convert the count matrix to <code>dgCMatrix</code> format at the beginning of the workflow.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="data-preparation.html#cb6-1" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;Matrix&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:S4Vectors&#39;:
## 
##     expand</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="data-preparation.html#cb9-1" tabindex="-1"></a><span class="fu">counts</span>(GeneExpressionMatrix) <span class="ot">&lt;-</span> <span class="fu">as</span>(<span class="fu">counts</span>(GeneExpressionMatrix), <span class="st">&quot;dgCMatrix&quot;</span>)</span></code></pre></div>
<p>Next we will add the cell information to <code>colData</code></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="data-preparation.html#cb10-1" tabindex="-1"></a><span class="fu">colData</span>(GeneExpressionMatrix) <span class="ot">&lt;-</span> <span class="fu">DataFrame</span>(<span class="at">Cluster =</span> <span class="fu">paste</span>(<span class="st">&quot;cluster&quot;</span>, <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">1000</span>, <span class="cn">TRUE</span>)))</span></code></pre></div>
<p>For the purpose of Epiregulon, it is important to provide the start and end position of the genes so that we can link genes to the peak regions.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="data-preparation.html#cb11-1" tabindex="-1"></a>seqnames <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;chr&quot;</span>, <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">100</span>, <span class="cn">TRUE</span>))</span>
<span id="cb11-2"><a href="data-preparation.html#cb11-2" tabindex="-1"></a>start <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100000</span>, <span class="dv">100</span>, <span class="cn">TRUE</span>)</span>
<span id="cb11-3"><a href="data-preparation.html#cb11-3" tabindex="-1"></a>end <span class="ot">&lt;-</span> start <span class="sc">+</span> <span class="fu">sample</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">500</span>, <span class="dv">100</span>, <span class="cn">TRUE</span>)</span>
<span id="cb11-4"><a href="data-preparation.html#cb11-4" tabindex="-1"></a>strand <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;+&quot;</span>, <span class="st">&quot;-&quot;</span>, <span class="st">&quot;*&quot;</span>), <span class="dv">100</span>, <span class="cn">TRUE</span>)</span>
<span id="cb11-5"><a href="data-preparation.html#cb11-5" tabindex="-1"></a></span>
<span id="cb11-6"><a href="data-preparation.html#cb11-6" tabindex="-1"></a>gr <span class="ot">&lt;-</span> <span class="fu">GRanges</span>(</span>
<span id="cb11-7"><a href="data-preparation.html#cb11-7" tabindex="-1"></a>    <span class="at">seqnames =</span> seqnames,</span>
<span id="cb11-8"><a href="data-preparation.html#cb11-8" tabindex="-1"></a>    <span class="at">ranges =</span> <span class="fu">IRanges</span>(<span class="at">start =</span> start, <span class="at">end =</span> end),</span>
<span id="cb11-9"><a href="data-preparation.html#cb11-9" tabindex="-1"></a>    <span class="at">strand =</span> strand</span>
<span id="cb11-10"><a href="data-preparation.html#cb11-10" tabindex="-1"></a>)</span></code></pre></div>
<p>Next we provide additional information about the genes. We can add them into the <code>mcols</code> as <code>DataFrame</code>. The <code>GRanges</code> become the <code>rowRanges</code> of the GeneExpressionMatrix.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="data-preparation.html#cb12-1" tabindex="-1"></a><span class="fu">mcols</span>(gr) <span class="ot">&lt;-</span> <span class="fu">DataFrame</span>(<span class="at">name =</span> <span class="fu">paste</span>(<span class="st">&quot;Gene&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">sep=</span><span class="st">&quot;-&quot;</span>),</span>
<span id="cb12-2"><a href="data-preparation.html#cb12-2" tabindex="-1"></a>                       <span class="at">ID =</span> <span class="fu">paste0</span>(<span class="st">&quot;ID&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>))</span>
<span id="cb12-3"><a href="data-preparation.html#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="data-preparation.html#cb12-4" tabindex="-1"></a><span class="fu">rowRanges</span>(GeneExpressionMatrix) <span class="ot">&lt;-</span> gr</span>
<span id="cb12-5"><a href="data-preparation.html#cb12-5" tabindex="-1"></a><span class="fu">rowRanges</span>(GeneExpressionMatrix)</span></code></pre></div>
<pre><code>## GRanges object with 100 ranges and 2 metadata columns:
##         seqnames      ranges strand |        name          ID
##            &lt;Rle&gt;   &lt;IRanges&gt;  &lt;Rle&gt; | &lt;character&gt; &lt;character&gt;
##     [1]     chr1     350-556      + |      Gene-1         ID1
##     [2]     chr2 70645-71002      - |      Gene-2         ID2
##     [3]     chr2 13183-13323      + |      Gene-3         ID3
##     [4]     chr2   3006-3489      * |      Gene-4         ID4
##     [5]     chr2 20116-20518      * |      Gene-5         ID5
##     ...      ...         ...    ... .         ...         ...
##    [96]     chr1 97104-97308      * |     Gene-96        ID96
##    [97]     chr2 82299-82526      * |     Gene-97        ID97
##    [98]     chr2 62701-62960      - |     Gene-98        ID98
##    [99]     chr2 49840-50314      + |     Gene-99        ID99
##   [100]     chr1 32332-32438      * |    Gene-100       ID100
##   -------
##   seqinfo: 2 sequences from an unspecified genome; no seqlengths</code></pre>
<p>The additional information about the genes will also appear in <code>rowData</code></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="data-preparation.html#cb14-1" tabindex="-1"></a><span class="fu">rowData</span>(GeneExpressionMatrix)</span></code></pre></div>
<pre><code>## DataFrame with 100 rows and 2 columns
##            name          ID
##     &lt;character&gt; &lt;character&gt;
## 1        Gene-1         ID1
## 2        Gene-2         ID2
## 3        Gene-3         ID3
## 4        Gene-4         ID4
## 5        Gene-5         ID5
## ...         ...         ...
## 96      Gene-96        ID96
## 97      Gene-97        ID97
## 98      Gene-98        ID98
## 99      Gene-99        ID99
## 100    Gene-100       ID100</code></pre>
<p>Finally we add some reduced dimension data which is needed for clustering</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="data-preparation.html#cb16-1" tabindex="-1"></a><span class="fu">reducedDim</span>(GeneExpressionMatrix, <span class="st">&quot;PCA&quot;</span>) <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="fu">rnorm</span>(<span class="dv">20000</span>), <span class="at">nrow=</span><span class="dv">1000</span>, <span class="at">ncol=</span><span class="dv">20</span>)</span>
<span id="cb16-2"><a href="data-preparation.html#cb16-2" tabindex="-1"></a>GeneExpressionMatrix</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 100 1000 
## metadata(0):
## assays(1): counts
## rownames: NULL
## rowData names(2): name ID
## colnames: NULL
## colData names(1): Cluster
## reducedDimNames(1): PCA
## mainExpName: NULL
## altExpNames(0):</code></pre>
<p>Repeat the process to create a <code>PeakMatrix</code></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="data-preparation.html#cb18-1" tabindex="-1"></a><span class="co"># add counts</span></span>
<span id="cb18-2"><a href="data-preparation.html#cb18-2" tabindex="-1"></a>counts <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rpois</span>(<span class="dv">1000000</span>, <span class="at">lambda =</span> <span class="dv">1</span>), <span class="at">ncol=</span><span class="dv">1000</span>, <span class="at">nrow=</span><span class="dv">1000</span>)</span>
<span id="cb18-3"><a href="data-preparation.html#cb18-3" tabindex="-1"></a>PeakMatrix <span class="ot">&lt;-</span> <span class="fu">SingleCellExperiment</span>(<span class="fu">list</span>(<span class="at">counts=</span>counts))</span>
<span id="cb18-4"><a href="data-preparation.html#cb18-4" tabindex="-1"></a><span class="fu">rownames</span>(PeakMatrix) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Peak&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">sep=</span><span class="st">&quot;-&quot;</span>)</span>
<span id="cb18-5"><a href="data-preparation.html#cb18-5" tabindex="-1"></a><span class="fu">colnames</span>(PeakMatrix) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Cell&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">sep=</span><span class="st">&quot;-&quot;</span>)</span>
<span id="cb18-6"><a href="data-preparation.html#cb18-6" tabindex="-1"></a></span>
<span id="cb18-7"><a href="data-preparation.html#cb18-7" tabindex="-1"></a><span class="co"># convert count matrix to dgCMatrix</span></span>
<span id="cb18-8"><a href="data-preparation.html#cb18-8" tabindex="-1"></a><span class="fu">counts</span>(PeakMatrix) <span class="ot">&lt;-</span> <span class="fu">as</span>(<span class="fu">counts</span>(PeakMatrix), <span class="st">&quot;dgCMatrix&quot;</span>)</span>
<span id="cb18-9"><a href="data-preparation.html#cb18-9" tabindex="-1"></a></span>
<span id="cb18-10"><a href="data-preparation.html#cb18-10" tabindex="-1"></a><span class="co"># add rowRanges</span></span>
<span id="cb18-11"><a href="data-preparation.html#cb18-11" tabindex="-1"></a>seqnames <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;chr&quot;</span>, <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">1000</span>, <span class="cn">TRUE</span>))</span>
<span id="cb18-12"><a href="data-preparation.html#cb18-12" tabindex="-1"></a>start <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100000</span>, <span class="dv">1000</span>, <span class="cn">TRUE</span>)</span>
<span id="cb18-13"><a href="data-preparation.html#cb18-13" tabindex="-1"></a>end <span class="ot">&lt;-</span> start <span class="sc">+</span> <span class="fu">sample</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">500</span>, <span class="dv">1000</span>, <span class="cn">TRUE</span>)</span>
<span id="cb18-14"><a href="data-preparation.html#cb18-14" tabindex="-1"></a>strand <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;+&quot;</span>, <span class="st">&quot;-&quot;</span>, <span class="st">&quot;*&quot;</span>), <span class="dv">1000</span>, <span class="cn">TRUE</span>)</span>
<span id="cb18-15"><a href="data-preparation.html#cb18-15" tabindex="-1"></a></span>
<span id="cb18-16"><a href="data-preparation.html#cb18-16" tabindex="-1"></a>gr <span class="ot">&lt;-</span> <span class="fu">GRanges</span>(</span>
<span id="cb18-17"><a href="data-preparation.html#cb18-17" tabindex="-1"></a>    <span class="at">seqnames =</span> seqnames,</span>
<span id="cb18-18"><a href="data-preparation.html#cb18-18" tabindex="-1"></a>    <span class="at">ranges =</span> <span class="fu">IRanges</span>(<span class="at">start =</span> start, <span class="at">end =</span> end),</span>
<span id="cb18-19"><a href="data-preparation.html#cb18-19" tabindex="-1"></a>    <span class="at">strand =</span> strand</span>
<span id="cb18-20"><a href="data-preparation.html#cb18-20" tabindex="-1"></a>)</span>
<span id="cb18-21"><a href="data-preparation.html#cb18-21" tabindex="-1"></a></span>
<span id="cb18-22"><a href="data-preparation.html#cb18-22" tabindex="-1"></a><span class="co"># add rowData</span></span>
<span id="cb18-23"><a href="data-preparation.html#cb18-23" tabindex="-1"></a><span class="fu">mcols</span>(gr) <span class="ot">&lt;-</span> <span class="fu">DataFrame</span>(<span class="at">name =</span> <span class="fu">paste</span>(<span class="st">&quot;Peak&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">sep=</span><span class="st">&quot;-&quot;</span>))</span>
<span id="cb18-24"><a href="data-preparation.html#cb18-24" tabindex="-1"></a></span>
<span id="cb18-25"><a href="data-preparation.html#cb18-25" tabindex="-1"></a><span class="fu">rowRanges</span>(PeakMatrix) <span class="ot">&lt;-</span> gr</span>
<span id="cb18-26"><a href="data-preparation.html#cb18-26" tabindex="-1"></a></span>
<span id="cb18-27"><a href="data-preparation.html#cb18-27" tabindex="-1"></a><span class="co"># add reduced dimensionality matrix</span></span>
<span id="cb18-28"><a href="data-preparation.html#cb18-28" tabindex="-1"></a></span>
<span id="cb18-29"><a href="data-preparation.html#cb18-29" tabindex="-1"></a><span class="fu">reducedDim</span>(PeakMatrix, <span class="st">&quot;ATAC_LSI&quot;</span>) <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="fu">rnorm</span>(<span class="dv">20000</span>), <span class="at">nrow=</span><span class="dv">1000</span>, <span class="at">ncol=</span><span class="dv">20</span>)</span>
<span id="cb18-30"><a href="data-preparation.html#cb18-30" tabindex="-1"></a>PeakMatrix</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 1000 1000 
## metadata(0):
## assays(1): counts
## rownames: NULL
## rowData names(1): name
## colnames(1000): Cell-1 Cell-2 ... Cell-999 Cell-1000
## colData names(0):
## reducedDimNames(1): ATAC_LSI
## mainExpName: NULL
## altExpNames(0):</code></pre>
<p>For more information on SingleCellExperiment, please refer to the <a href="%22https://bioconductor.org/packages/release/bioc/html/SingleCellExperiment.html%22">documentation</a> on bioconductor.</p>
<p>For a real example of a properly formatted <code>SingleCellExperiment</code> object, check out datasets from the <a href="https://www.bioconductor.org/packages/release/data/experiment/html/scMultiome.html">scMultiome</a> package. Both the GeneExpressionMatrix and PeakMatrix are combined into a <code>MultiAssayExperiment</code> object.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="data-preparation.html#cb20-1" tabindex="-1"></a>mae <span class="ot">&lt;-</span> scMultiome<span class="sc">::</span><span class="fu">reprogramSeq</span>()</span></code></pre></div>
<pre><code>## see ?scMultiome and browseVignettes(&#39;scMultiome&#39;) for documentation</code></pre>
<pre><code>## loading from cache</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="data-preparation.html#cb23-1" tabindex="-1"></a>GeneExpressMatrix <span class="ot">&lt;-</span> mae[[<span class="st">&quot;GeneExpressMatrix &quot;</span>]]</span>
<span id="cb23-2"><a href="data-preparation.html#cb23-2" tabindex="-1"></a>GeneExpressMatrix</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="data-preparation.html#cb25-1" tabindex="-1"></a>PeakMatrix <span class="ot">&lt;-</span> mae[[<span class="st">&quot;PeakMatrix&quot;</span>]]</span>
<span id="cb25-2"><a href="data-preparation.html#cb25-2" tabindex="-1"></a>PeakMatrix</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 126602 3903 
## metadata(1): .internal
## assays(1): counts
## rownames: NULL
## rowData names(1): idx
## colnames(3903): reprogram#TTAGGAACAAGGTACG-1
##   reprogram#GAGCGGTCAACCTGGT-1 ... reprogram#GGTTACTAGACACCGC-1
##   reprogram#CGCTATGAGTGAACAG-1
## colData names(23): BlacklistRatio DoubletEnrichment ... ReadsInPeaks
##   FRIP
## reducedDimNames(0):
## mainExpName: NULL
## altExpNames(0):</code></pre>
</div>
<div id="starting-from-an-archr-object" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Starting from an ArchR object<a href="data-preparation.html#starting-from-an-archr-object" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Epiregulon is designed to work seamlessly with ArchR. GeneExpressionMatrix and PeakMatrix can be easily exported from ArchR using ArchR’s build-in function.</p>
<p>Download a test ArchR project</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="data-preparation.html#cb27-1" tabindex="-1"></a><span class="fu">library</span>(ArchR)</span>
<span id="cb27-2"><a href="data-preparation.html#cb27-2" tabindex="-1"></a>archr.proj <span class="ot">&lt;-</span> <span class="fu">getTestProject</span>()</span></code></pre></div>
<p>Check available matrices in ArchR project</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="data-preparation.html#cb28-1" tabindex="-1"></a><span class="fu">getAvailableMatrices</span>(<span class="at">ArchRProj =</span> archr.proj)</span></code></pre></div>
<pre><code>## [1] &quot;GeneIntegrationMatrix&quot; &quot;GeneScoreMatrix&quot;       &quot;MotifMatrix&quot;          
## [4] &quot;PeakMatrix&quot;            &quot;TileMatrix&quot;</code></pre>
<p>Export the GeneExpressionMatrix and PeakMatrix from the ArchR project.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="data-preparation.html#cb30-1" tabindex="-1"></a>GeneExpressionMatrix <span class="ot">&lt;-</span> <span class="fu">getMatrixFromProject</span>(<span class="at">ArchRProj =</span> archr.proj, <span class="at">useMatrix =</span> <span class="st">&quot;GeneIntegrationMatrix&quot;</span>)</span>
<span id="cb30-2"><a href="data-preparation.html#cb30-2" tabindex="-1"></a>PeakMatrix <span class="ot">&lt;-</span> <span class="fu">getMatrixFromProject</span>(<span class="at">ArchRProj =</span> archr.proj, <span class="at">useMatrix =</span> <span class="st">&quot;PeakMatrix&quot;</span>)</span>
<span id="cb30-3"><a href="data-preparation.html#cb30-3" tabindex="-1"></a>GeneExpressionMatrix</span></code></pre></div>
<pre><code>## class: SummarizedExperiment 
## dim: 2051 127 
## metadata(0):
## assays(1): GeneIntegrationMatrix
## rownames: NULL
## rowData names(6): seqnames start ... name idx
## colnames(127): PBSmall#B.43 PBSmall#T.24 ... PBSmall#B.37 PBSmall#B.4
## colData names(20): BlacklistRatio nDiFrags ... predictedGroup_Un
##   predictedScore_Un</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="data-preparation.html#cb32-1" tabindex="-1"></a>PeakMatrix</span></code></pre></div>
<pre><code>## class: RangedSummarizedExperiment 
## dim: 2142 127 
## metadata(0):
## assays(1): PeakMatrix
## rownames: NULL
## rowData names(1): idx
## colnames(127): PBSmall#B.43 PBSmall#T.24 ... PBSmall#B.37 PBSmall#B.4
## colData names(20): BlacklistRatio nDiFrags ... predictedGroup_Un
##   predictedScore_Un</code></pre>
<p>The GeneExpressionMatrix and PeakMatrix exported from ArchR project are in the form of <code>SummarizedExperiment</code> and <code>RangedSummarizedExperiment</code> respectively. We provide a helper function to convert both to <code>SingleCellExperiment</code> class. Furthermore, the genomic location of the genes are transferred from <code>rowData</code> in the <code>RangedSummarizedExperiment</code> to the <code>rowRanges</code> of the <code>SingleCellExperiment</code>.</p>
<p>Please note that GeneExpressionMatrix extracted from ArchR project contain normalized counts (not logged) and for clarity, we rename the assay as “normalizedCounts”</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="data-preparation.html#cb34-1" tabindex="-1"></a><span class="fu">library</span>(epiregulon.archr)</span></code></pre></div>
<pre><code>## Loading required package: epiregulon</code></pre>
<pre><code>## 
## Attaching package: &#39;epiregulon.archr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:epiregulon&#39;:
## 
##     addMotifScore, addTFMotifInfo, calculateP2G, getTFMotifInfo</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="data-preparation.html#cb38-1" tabindex="-1"></a>GeneExpressionMatrix <span class="ot">&lt;-</span> <span class="fu">ArchRMatrix2SCE</span>(<span class="at">rse =</span> GeneExpressionMatrix, <span class="at">rename =</span> <span class="st">&quot;normalizedCounts&quot;</span>)</span>
<span id="cb38-2"><a href="data-preparation.html#cb38-2" tabindex="-1"></a>GeneExpressionMatrix</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 2051 127 
## metadata(0):
## assays(1): normalizedCounts
## rownames: NULL
## rowData names(2): name idx
## colnames(127): PBSmall#B.43 PBSmall#T.24 ... PBSmall#B.37 PBSmall#B.4
## colData names(20): BlacklistRatio nDiFrags ... predictedGroup_Un
##   predictedScore_Un
## reducedDimNames(0):
## mainExpName: NULL
## altExpNames(0):</code></pre>
<p>We can also transform the counts to logcounts. This will add a new assay and we name it as “logcounts”.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="data-preparation.html#cb40-1" tabindex="-1"></a>GeneExpressionMatrix <span class="ot">&lt;-</span> <span class="fu">ArchRMatrix2SCE</span>(<span class="at">rse =</span> GeneExpressionMatrix, <span class="at">transform =</span> <span class="cn">TRUE</span>, <span class="at">transform_method =</span> <span class="st">&quot;log&quot;</span>, <span class="at">log_name =</span> <span class="st">&quot;logcounts&quot;</span>)</span>
<span id="cb40-2"><a href="data-preparation.html#cb40-2" tabindex="-1"></a>GeneExpressionMatrix</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 2051 127 
## metadata(0):
## assays(2): counts logcounts
## rownames: NULL
## rowData names(2): name idx
## colnames(127): PBSmall#B.43 PBSmall#T.24 ... PBSmall#B.37 PBSmall#B.4
## colData names(20): BlacklistRatio nDiFrags ... predictedGroup_Un
##   predictedScore_Un
## reducedDimNames(0):
## mainExpName: NULL
## altExpNames(0):</code></pre>
<p>Check that rowRanges have been transferred</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="data-preparation.html#cb42-1" tabindex="-1"></a><span class="fu">rowRanges</span>(GeneExpressionMatrix)</span></code></pre></div>
<pre><code>## GRanges object with 2051 ranges and 2 metadata columns:
##          seqnames              ranges strand |        name       idx
##             &lt;Rle&gt;           &lt;IRanges&gt;  &lt;Rle&gt; | &lt;character&gt; &lt;integer&gt;
##      [1]    chr11       126987-139152      - |   LINC01001         1
##      [2]    chr11       193080-194573      + |     SCGB1C1         2
##      [3]    chr11       196761-200258      + |        ODF3         3
##      [4]    chr11       202924-207422      - |       BET1L         4
##      [5]    chr11       208530-215110      + |       RIC8A         5
##      ...      ...                 ...    ... .         ...       ...
##   [2047]     chr5 180551357-180552304      - |       OR2V1       827
##   [2048]     chr5 180581943-180582890      + |       OR2V2       828
##   [2049]     chr5 180620924-180632177      - |       TRIM7       829
##   [2050]     chr5 180650263-180662808      + |      TRIM41       830
##   [2051]     chr5 180683386-180688119      - |      TRIM52       831
##   -------
##   seqinfo: 2 sequences from an unspecified genome; no seqlengths</code></pre>
<p>We next convert the PeakMatrix to a <code>SingleCellExperiment</code> object. The counts exported from ArchR are raw counts and thus we rename the assay as “counts”</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="data-preparation.html#cb44-1" tabindex="-1"></a>PeakMatrix <span class="ot">&lt;-</span> <span class="fu">ArchRMatrix2SCE</span>(PeakMatrix, <span class="at">rename =</span> <span class="st">&quot;counts&quot;</span>)</span>
<span id="cb44-2"><a href="data-preparation.html#cb44-2" tabindex="-1"></a>PeakMatrix</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 2142 127 
## metadata(0):
## assays(1): counts
## rownames: NULL
## rowData names(1): idx
## colnames(127): PBSmall#B.43 PBSmall#T.24 ... PBSmall#B.37 PBSmall#B.4
## colData names(20): BlacklistRatio nDiFrags ... predictedGroup_Un
##   predictedScore_Un
## reducedDimNames(0):
## mainExpName: NULL
## altExpNames(0):</code></pre>
<p>Neither SummarizedExperiment object or RangedSummarizedExperiment object contains reduced dimension, so we must extract the reduced dimensionality matrix from the ArchR project and add it to GeneExpressionMatrix and/or PeakMatrix</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="data-preparation.html#cb46-1" tabindex="-1"></a><span class="fu">reducedDim</span>(PeakMatrix, <span class="st">&quot;IterativeLSI&quot;</span>) <span class="ot">&lt;-</span> <span class="fu">getReducedDims</span>(<span class="at">ArchRProj =</span> archr.proj, <span class="at">reducedDims =</span> <span class="st">&quot;IterativeLSI&quot;</span>)</span></code></pre></div>
<p>Refer to ArchR <a href="https://www.archrproject.com/bookdown/index.html">manual</a> for full documentation.</p>
</div>
<div id="starting-from-a-seuratsignac-object" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Starting from a Seurat/Signac object<a href="data-preparation.html#starting-from-a-seuratsignac-object" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We download an example multimodel dataset from <a href="https://github.com/satijalab/seurat-data">SeuratData</a>.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="data-preparation.html#cb47-1" tabindex="-1"></a><span class="fu">library</span>(SeuratData)</span>
<span id="cb47-2"><a href="data-preparation.html#cb47-2" tabindex="-1"></a></span>
<span id="cb47-3"><a href="data-preparation.html#cb47-3" tabindex="-1"></a><span class="fu">InstallData</span>(<span class="st">&quot;pbmcMultiome&quot;</span>)</span></code></pre></div>
<p>This is a PBMC dataset consisting of both RNAseq and ATACseq data and we load each modality as a separate Seurat object</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="data-preparation.html#cb48-1" tabindex="-1"></a><span class="fu">library</span>(Seurat)</span></code></pre></div>
<pre><code>## Loading required package: SeuratObject</code></pre>
<pre><code>## Loading required package: sp</code></pre>
<pre><code>## 
## Attaching package: &#39;sp&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:IRanges&#39;:
## 
##     %over%</code></pre>
<pre><code>## 
## Attaching package: &#39;SeuratObject&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:SummarizedExperiment&#39;:
## 
##     Assays</code></pre>
<pre><code>## The following object is masked from &#39;package:GenomicRanges&#39;:
## 
##     intersect</code></pre>
<pre><code>## The following object is masked from &#39;package:GenomeInfoDb&#39;:
## 
##     intersect</code></pre>
<pre><code>## The following object is masked from &#39;package:IRanges&#39;:
## 
##     intersect</code></pre>
<pre><code>## The following object is masked from &#39;package:S4Vectors&#39;:
## 
##     intersect</code></pre>
<pre><code>## The following object is masked from &#39;package:BiocGenerics&#39;:
## 
##     intersect</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, t</code></pre>
<pre><code>## 
## Attaching package: &#39;Seurat&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:SummarizedExperiment&#39;:
## 
##     Assays</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="data-preparation.html#cb63-1" tabindex="-1"></a><span class="fu">library</span>(Signac)</span>
<span id="cb63-2"><a href="data-preparation.html#cb63-2" tabindex="-1"></a><span class="fu">library</span>(SeuratData)</span></code></pre></div>
<pre><code>## ── Installed datasets ──────────────────────────────── SeuratData v0.2.2.9001 ──</code></pre>
<pre><code>## ✔ pbmcMultiome 0.1.4</code></pre>
<pre><code>## ────────────────────────────────────── Key ─────────────────────────────────────</code></pre>
<pre><code>## ✔ Dataset loaded successfully
## ❯ Dataset built with a newer version of Seurat than installed
## ❓ Unknown version of Seurat installed</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="data-preparation.html#cb68-1" tabindex="-1"></a>pbmc.rna <span class="ot">&lt;-</span> <span class="fu">LoadData</span>(<span class="st">&quot;pbmcMultiome&quot;</span>, <span class="st">&quot;pbmc.rna&quot;</span>)</span></code></pre></div>
<pre><code>## Validating object structure</code></pre>
<pre><code>## Updating object slots</code></pre>
<pre><code>## Ensuring keys are in the proper structure
## Ensuring keys are in the proper structure</code></pre>
<pre><code>## Ensuring feature names don&#39;t have underscores or pipes</code></pre>
<pre><code>## Updating slots in RNA</code></pre>
<pre><code>## Validating object structure for Assay &#39;RNA&#39;</code></pre>
<pre><code>## Object representation is consistent with the most current Seurat version</code></pre>
<pre><code>## Warning: Assay RNA changing from Assay to Assay5</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="data-preparation.html#cb77-1" tabindex="-1"></a>pbmc.atac <span class="ot">&lt;-</span> <span class="fu">LoadData</span>(<span class="st">&quot;pbmcMultiome&quot;</span>, <span class="st">&quot;pbmc.atac&quot;</span>)</span></code></pre></div>
<pre><code>## Validating object structure</code></pre>
<pre><code>## Updating object slots</code></pre>
<pre><code>## Ensuring keys are in the proper structure
## Ensuring keys are in the proper structure</code></pre>
<pre><code>## Ensuring feature names don&#39;t have underscores or pipes</code></pre>
<pre><code>## Updating slots in ATAC</code></pre>
<pre><code>## Validating object structure for ChromatinAssay &#39;ATAC&#39;</code></pre>
<pre><code>## Object representation is consistent with the most current Seurat version</code></pre>
<p>We first convert the RNA Seurat object to GeneExpressionMatrix <code>SingleCellExperiment</code> class.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="data-preparation.html#cb85-1" tabindex="-1"></a>GeneExpressionMatrix <span class="ot">&lt;-</span> <span class="fu">as.SingleCellExperiment</span>(pbmc.rna, <span class="at">assay=</span><span class="st">&quot;RNA&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Layer &#39;scale.data&#39; is empty</code></pre>
<p>Because these genes are missing genomic positions, we must first annotate them with a genomic database, for example ensembl</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="data-preparation.html#cb87-1" tabindex="-1"></a><span class="fu">library</span>(AnnotationHub)</span>
<span id="cb87-2"><a href="data-preparation.html#cb87-2" tabindex="-1"></a>ah <span class="ot">&lt;-</span> <span class="fu">AnnotationHub</span>()</span>
<span id="cb87-3"><a href="data-preparation.html#cb87-3" tabindex="-1"></a>edb <span class="ot">&lt;-</span> ah[[<span class="st">&quot;AH98047&quot;</span>]]  <span class="co">#&quot;EnsDb.Hsapiens.v105&quot;</span></span></code></pre></div>
<pre><code>## loading from cache</code></pre>
<pre><code>## require(&quot;ensembldb&quot;)</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="data-preparation.html#cb90-1" tabindex="-1"></a>gr <span class="ot">&lt;-</span> <span class="fu">genes</span>(edb, <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">&quot;gene_id&quot;</span>, <span class="st">&quot;gene_name&quot;</span>))</span></code></pre></div>
<p>We retain only the genes that have genomic positions. The genomic positions are necessary to link peak positions to the nearby target genes.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="data-preparation.html#cb91-1" tabindex="-1"></a>common_genes <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(<span class="fu">intersect</span>(gr<span class="sc">$</span>gene_name, <span class="fu">rownames</span>(GeneExpressionMatrix)))</span>
<span id="cb91-2"><a href="data-preparation.html#cb91-2" tabindex="-1"></a>GeneExpressionMatrix <span class="ot">&lt;-</span> GeneExpressionMatrix[common_genes,]</span>
<span id="cb91-3"><a href="data-preparation.html#cb91-3" tabindex="-1"></a><span class="fu">rowRanges</span>(GeneExpressionMatrix) <span class="ot">&lt;-</span> gr[<span class="fu">match</span>(common_genes, gr<span class="sc">$</span>gene_name)]</span>
<span id="cb91-4"><a href="data-preparation.html#cb91-4" tabindex="-1"></a><span class="fu">rowRanges</span>(GeneExpressionMatrix)</span></code></pre></div>
<pre><code>## GRanges object with 23644 ranges and 2 metadata columns:
##                   seqnames            ranges strand |         gene_id
##                      &lt;Rle&gt;         &lt;IRanges&gt;  &lt;Rle&gt; |     &lt;character&gt;
##   ENSG00000243485        1       29554-31109      + | ENSG00000243485
##   ENSG00000237613        1       34554-36081      - | ENSG00000237613
##   ENSG00000186092        1       65419-71585      + | ENSG00000186092
##   ENSG00000284733        1     450740-451678      - | ENSG00000284733
##   ENSG00000284662        1     685716-686654      - | ENSG00000284662
##               ...      ...               ...    ... .             ...
##   ENSG00000228296        Y 25063083-25099892      - | ENSG00000228296
##   ENSG00000223641        Y 25182277-25213389      - | ENSG00000223641
##   ENSG00000228786        Y 25378300-25394719      - | ENSG00000228786
##   ENSG00000172288        Y 25622162-25624902      + | ENSG00000172288
##   ENSG00000231141        Y 25728490-25733388      + | ENSG00000231141
##                      gene_name
##                    &lt;character&gt;
##   ENSG00000243485  MIR1302-2HG
##   ENSG00000237613      FAM138A
##   ENSG00000186092        OR4F5
##   ENSG00000284733       OR4F29
##   ENSG00000284662       OR4F16
##               ...          ...
##   ENSG00000228296       TTTY4C
##   ENSG00000223641      TTTY17C
##   ENSG00000228786 LINC00266-4P
##   ENSG00000172288         CDY1
##   ENSG00000231141        TTTY3
##   -------
##   seqinfo: 456 sequences (1 circular) from GRCh38 genome</code></pre>
<p>We then convert ATAC matrix to PeakMatrix. After conversion to <code>SingleCellExperiment</code>, the peak positions appear as rownames and must be converted to <code>GRanges</code>.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="data-preparation.html#cb93-1" tabindex="-1"></a>PeakMatrix <span class="ot">&lt;-</span> <span class="fu">as.SingleCellExperiment</span>(pbmc.atac, <span class="at">assay=</span><span class="st">&quot;ATAC&quot;</span>)</span>
<span id="cb93-2"><a href="data-preparation.html#cb93-2" tabindex="-1"></a></span>
<span id="cb93-3"><a href="data-preparation.html#cb93-3" tabindex="-1"></a>peak_position <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(<span class="fu">rownames</span>(PeakMatrix), <span class="at">split =</span> <span class="st">&quot;-&quot;</span>)</span>
<span id="cb93-4"><a href="data-preparation.html#cb93-4" tabindex="-1"></a>gr <span class="ot">&lt;-</span> <span class="fu">GRanges</span>(</span>
<span id="cb93-5"><a href="data-preparation.html#cb93-5" tabindex="-1"></a>    <span class="at">seqnames =</span> <span class="fu">sapply</span>(peak_position,<span class="st">&quot;[&quot;</span>,<span class="dv">1</span>),</span>
<span id="cb93-6"><a href="data-preparation.html#cb93-6" tabindex="-1"></a>    <span class="at">ranges =</span> <span class="fu">IRanges</span>(<span class="at">start =</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(peak_position,<span class="st">&quot;[&quot;</span>,<span class="dv">2</span>)), </span>
<span id="cb93-7"><a href="data-preparation.html#cb93-7" tabindex="-1"></a>                     <span class="at">end =</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(peak_position,<span class="st">&quot;[&quot;</span>,<span class="dv">3</span>)))</span>
<span id="cb93-8"><a href="data-preparation.html#cb93-8" tabindex="-1"></a>)</span>
<span id="cb93-9"><a href="data-preparation.html#cb93-9" tabindex="-1"></a><span class="fu">rowRanges</span>(PeakMatrix) <span class="ot">&lt;-</span> gr</span>
<span id="cb93-10"><a href="data-preparation.html#cb93-10" tabindex="-1"></a>PeakMatrix</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 108377 11909 
## metadata(0):
## assays(2): counts logcounts
## rownames: NULL
## rowData names(0):
## colnames(11909): AAACAGCCAAGGAATC-1 AAACAGCCAATCCCTT-1 ...
##   TTTGTTGGTTGGTTAG-1 TTTGTTGGTTTGCAGA-1
## colData names(5): orig.ident nCount_ATAC nFeature_ATAC
##   seurat_annotations ident
## reducedDimNames(0):
## mainExpName: ATAC
## altExpNames(0):</code></pre>
<p>For more information, refer to Signac <a href="https://stuartlab.org/signac/articles/overview">tutorial</a></p>
</div>
<div id="starting-from-anndata" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Starting from AnnData<a href="data-preparation.html#starting-from-anndata" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We download an example PBMC anndata dataset from <a href="https://scglue.readthedocs.io/en/latest/data.html">scglue</a>.</p>
<p>We first import the GeneExpressionMatrix.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="data-preparation.html#cb95-1" tabindex="-1"></a><span class="fu">library</span>(zellkonverter)</span></code></pre></div>
<pre><code>## Registered S3 method overwritten by &#39;zellkonverter&#39;:
##   method                                             from      
##   py_to_r.pandas.core.arrays.categorical.Categorical reticulate</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="data-preparation.html#cb97-1" tabindex="-1"></a><span class="fu">library</span>(GenomicRanges)</span>
<span id="cb97-2"><a href="data-preparation.html#cb97-2" tabindex="-1"></a><span class="fu">library</span>(SingleCellExperiment)</span>
<span id="cb97-3"><a href="data-preparation.html#cb97-3" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;http://download.gao-lab.org/GLUE/dataset/10x-Multiome-Pbmc10k-RNA.h5ad&quot;</span></span>
<span id="cb97-4"><a href="data-preparation.html#cb97-4" tabindex="-1"></a>destfile <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">&quot;.h5ad&quot;</span>)</span>
<span id="cb97-5"><a href="data-preparation.html#cb97-5" tabindex="-1"></a></span>
<span id="cb97-6"><a href="data-preparation.html#cb97-6" tabindex="-1"></a><span class="co"># Download the file</span></span>
<span id="cb97-7"><a href="data-preparation.html#cb97-7" tabindex="-1"></a><span class="fu">download.file</span>(url, destfile, <span class="at">mode =</span> <span class="st">&quot;wb&quot;</span>)</span>
<span id="cb97-8"><a href="data-preparation.html#cb97-8" tabindex="-1"></a>GeneExpressionMatrix <span class="ot">&lt;-</span> <span class="fu">readH5AD</span>(destfile)</span></code></pre></div>
<p>The field “chrom” “chromStart” “chromEnd” correspond to genomic positions of the genes.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="data-preparation.html#cb98-1" tabindex="-1"></a><span class="fu">rowData</span>(GeneExpressionMatrix)</span></code></pre></div>
<pre><code>## DataFrame with 29095 rows and 26 columns
##                   gene_ids   feature_types   genome      chrom chromStart
##                &lt;character&gt;        &lt;factor&gt; &lt;factor&gt;   &lt;factor&gt;  &lt;numeric&gt;
## AL627309.1 ENSG00000238009 Gene Expression   GRCh38       chr1      89294
## AL627309.5 ENSG00000241860 Gene Expression   GRCh38       chr1     141473
## AL627309.4 ENSG00000241599 Gene Expression   GRCh38       chr1     160445
## AP006222.2 ENSG00000286448 Gene Expression   GRCh38       chr1     266854
## AL669831.2 ENSG00000229905 Gene Expression   GRCh38       chr1     760910
## ...                    ...             ...      ...        ...        ...
## AC004556.3 ENSG00000276345 Gene Expression   GRCh38 KI270721.1       2584
## AC233755.2 ENSG00000277856 Gene Expression   GRCh38 KI270726.1      26240
## AC233755.1 ENSG00000275063 Gene Expression   GRCh38 KI270726.1      41443
## AC007325.1 ENSG00000276017 Gene Expression   GRCh38 KI270734.1      72410
## AC007325.4 ENSG00000278817 Gene Expression   GRCh38 KI270734.1     131493
##             chromEnd            name    score   strand thickStart thickEnd
##            &lt;numeric&gt;     &lt;character&gt; &lt;factor&gt; &lt;factor&gt;   &lt;factor&gt; &lt;factor&gt;
## AL627309.1    133723 ENSG00000238009        .        -          .        .
## AL627309.5    173862 ENSG00000241860        .        -          .        .
## AL627309.4    161525 ENSG00000241599        .        +          .        .
## AP006222.2    268655 ENSG00000286448        .        +          .        .
## AL669831.2    761989 ENSG00000229905        .        +          .        .
## ...              ...             ...      ...      ...        ...      ...
## AC004556.3     11802 ENSG00000276345        .        +          .        .
## AC233755.2     26534 ENSG00000277856        .        +          .        .
## AC233755.1     41876 ENSG00000275063        .        +          .        .
## AC007325.1     74814 ENSG00000276017        .        +          .        .
## AC007325.4    137392 ENSG00000278817        .        +          .        .
##             itemRgb blockCount blockSizes blockStarts      gene_type  gene_name
##            &lt;factor&gt;   &lt;factor&gt;   &lt;factor&gt;    &lt;factor&gt;       &lt;factor&gt;   &lt;factor&gt;
## AL627309.1        .          .          .           .         lncRNA AL627309.1
## AL627309.5        .          .          .           .         lncRNA AL627309.5
## AL627309.4        .          .          .           .         lncRNA AL627309.4
## AP006222.2        .          .          .           .         lncRNA AP006222.2
## AL669831.2        .          .          .           .         lncRNA AL669831.2
## ...             ...        ...        ...         ...            ...        ...
## AC004556.3        .          .          .           . protein_coding AC004556.3
## AC233755.2        .          .          .           . protein_coding AC233755.2
## AC233755.1        .          .          .           . protein_coding AC233755.1
## AC007325.1        .          .          .           . protein_coding AC007325.1
## AC007325.4        .          .          .           . protein_coding AC007325.4
##             hgnc_id          havana_gene               tag  n_counts
##            &lt;factor&gt;             &lt;factor&gt;          &lt;factor&gt; &lt;numeric&gt;
## AL627309.1       NA OTTHUMG00000001096.2 overlapping_locus        70
## AL627309.5       NA OTTHUMG00000002480.4 ncRNA_host              442
## AL627309.4       NA OTTHUMG00000002525.1 NA                       44
## AP006222.2       NA OTTHUMG00000194680.1 NA                        1
## AL669831.2       NA OTTHUMG00000002408.1 NA                       10
## ...             ...                  ...               ...       ...
## AC004556.3       NA                   NA                NA       320
## AC233755.2       NA                   NA                NA         1
## AC233755.1       NA                   NA                NA         1
## AC007325.1       NA                   NA                NA         3
## AC007325.4       NA                   NA                NA        43
##            highly_variable highly_variable_rank       means   variances
##                  &lt;logical&gt;            &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
## AL627309.1           FALSE                  NaN 0.007268196 0.008462225
## AL627309.5           FALSE                  NaN 0.045893469 0.050853072
## AL627309.4           FALSE                  NaN 0.004568581 0.004755865
## AP006222.2           FALSE                  NaN 0.000103831 0.000103831
## AL669831.2           FALSE                  NaN 0.001038314 0.001037343
## ...                    ...                  ...         ...         ...
## AC004556.3           FALSE                  NaN 0.033226041 0.035448356
## AC233755.2           FALSE                  NaN 0.000103831 0.000103831
## AC233755.1           FALSE                  NaN 0.000103831 0.000103831
## AC007325.1           FALSE                  NaN 0.000311494 0.000311429
## AC007325.4           FALSE                  NaN 0.004464749 0.004445277
##            variances_norm
##                 &lt;numeric&gt;
## AL627309.1       0.971895
## AL627309.5       0.888672
## AL627309.4       0.891707
## AP006222.2       0.999904
## AL669831.2       0.933916
## ...                   ...
## AC004556.3       0.856870
## AC233755.2       0.999904
## AC233755.1       0.999904
## AC007325.1       0.975766
## AC007325.4       0.854162</code></pre>
<p>They must be renamed to “seqnames” “start” and “end” before conversion to <code>GRanges</code></p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="data-preparation.html#cb100-1" tabindex="-1"></a>index_to_rename <span class="ot">&lt;-</span> <span class="fu">match</span>(<span class="fu">c</span>(<span class="st">&quot;chrom&quot;</span>, <span class="st">&quot;chromStart&quot;</span>,  <span class="st">&quot;chromEnd&quot;</span>), <span class="fu">colnames</span>(<span class="fu">rowData</span>(GeneExpressionMatrix)))</span>
<span id="cb100-2"><a href="data-preparation.html#cb100-2" tabindex="-1"></a><span class="fu">colnames</span>(<span class="fu">rowData</span>(GeneExpressionMatrix))[index_to_rename] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;seqnames&quot;</span>, <span class="st">&quot;start&quot;</span>,   <span class="st">&quot;end&quot;</span>)</span>
<span id="cb100-3"><a href="data-preparation.html#cb100-3" tabindex="-1"></a><span class="fu">rowRanges</span>(GeneExpressionMatrix) <span class="ot">&lt;-</span> <span class="fu">GRanges</span>(<span class="fu">rowData</span>(GeneExpressionMatrix))</span>
<span id="cb100-4"><a href="data-preparation.html#cb100-4" tabindex="-1"></a><span class="fu">rowRanges</span>(GeneExpressionMatrix)</span></code></pre></div>
<pre><code>## GRanges object with 29095 ranges and 22 metadata columns:
##                seqnames        ranges strand |        gene_ids   feature_types
##                   &lt;Rle&gt;     &lt;IRanges&gt;  &lt;Rle&gt; |     &lt;character&gt;        &lt;factor&gt;
##   AL627309.1       chr1  89294-133723      - | ENSG00000238009 Gene Expression
##   AL627309.5       chr1 141473-173862      - | ENSG00000241860 Gene Expression
##   AL627309.4       chr1 160445-161525      + | ENSG00000241599 Gene Expression
##   AP006222.2       chr1 266854-268655      + | ENSG00000286448 Gene Expression
##   AL669831.2       chr1 760910-761989      + | ENSG00000229905 Gene Expression
##          ...        ...           ...    ... .             ...             ...
##   AC004556.3 KI270721.1    2584-11802      + | ENSG00000276345 Gene Expression
##   AC233755.2 KI270726.1   26240-26534      + | ENSG00000277856 Gene Expression
##   AC233755.1 KI270726.1   41443-41876      + | ENSG00000275063 Gene Expression
##   AC007325.1 KI270734.1   72410-74814      + | ENSG00000276017 Gene Expression
##   AC007325.4 KI270734.1 131493-137392      + | ENSG00000278817 Gene Expression
##                genome            name    score thickStart thickEnd  itemRgb
##              &lt;factor&gt;     &lt;character&gt; &lt;factor&gt;   &lt;factor&gt; &lt;factor&gt; &lt;factor&gt;
##   AL627309.1   GRCh38 ENSG00000238009        .          .        .        .
##   AL627309.5   GRCh38 ENSG00000241860        .          .        .        .
##   AL627309.4   GRCh38 ENSG00000241599        .          .        .        .
##   AP006222.2   GRCh38 ENSG00000286448        .          .        .        .
##   AL669831.2   GRCh38 ENSG00000229905        .          .        .        .
##          ...      ...             ...      ...        ...      ...      ...
##   AC004556.3   GRCh38 ENSG00000276345        .          .        .        .
##   AC233755.2   GRCh38 ENSG00000277856        .          .        .        .
##   AC233755.1   GRCh38 ENSG00000275063        .          .        .        .
##   AC007325.1   GRCh38 ENSG00000276017        .          .        .        .
##   AC007325.4   GRCh38 ENSG00000278817        .          .        .        .
##              blockCount blockSizes blockStarts      gene_type  gene_name
##                &lt;factor&gt;   &lt;factor&gt;    &lt;factor&gt;       &lt;factor&gt;   &lt;factor&gt;
##   AL627309.1          .          .           .         lncRNA AL627309.1
##   AL627309.5          .          .           .         lncRNA AL627309.5
##   AL627309.4          .          .           .         lncRNA AL627309.4
##   AP006222.2          .          .           .         lncRNA AP006222.2
##   AL669831.2          .          .           .         lncRNA AL669831.2
##          ...        ...        ...         ...            ...        ...
##   AC004556.3          .          .           . protein_coding AC004556.3
##   AC233755.2          .          .           . protein_coding AC233755.2
##   AC233755.1          .          .           . protein_coding AC233755.1
##   AC007325.1          .          .           . protein_coding AC007325.1
##   AC007325.4          .          .           . protein_coding AC007325.4
##               hgnc_id          havana_gene               tag  n_counts
##              &lt;factor&gt;             &lt;factor&gt;          &lt;factor&gt; &lt;numeric&gt;
##   AL627309.1       NA OTTHUMG00000001096.2 overlapping_locus        70
##   AL627309.5       NA OTTHUMG00000002480.4 ncRNA_host              442
##   AL627309.4       NA OTTHUMG00000002525.1 NA                       44
##   AP006222.2       NA OTTHUMG00000194680.1 NA                        1
##   AL669831.2       NA OTTHUMG00000002408.1 NA                       10
##          ...      ...                  ...               ...       ...
##   AC004556.3       NA                   NA                NA       320
##   AC233755.2       NA                   NA                NA         1
##   AC233755.1       NA                   NA                NA         1
##   AC007325.1       NA                   NA                NA         3
##   AC007325.4       NA                   NA                NA        43
##              highly_variable highly_variable_rank       means   variances
##                    &lt;logical&gt;            &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
##   AL627309.1           FALSE                  NaN 0.007268196 0.008462225
##   AL627309.5           FALSE                  NaN 0.045893469 0.050853072
##   AL627309.4           FALSE                  NaN 0.004568581 0.004755865
##   AP006222.2           FALSE                  NaN 0.000103831 0.000103831
##   AL669831.2           FALSE                  NaN 0.001038314 0.001037343
##          ...             ...                  ...         ...         ...
##   AC004556.3           FALSE                  NaN 0.033226041 0.035448356
##   AC233755.2           FALSE                  NaN 0.000103831 0.000103831
##   AC233755.1           FALSE                  NaN 0.000103831 0.000103831
##   AC007325.1           FALSE                  NaN 0.000311494 0.000311429
##   AC007325.4           FALSE                  NaN 0.004464749 0.004445277
##              variances_norm
##                   &lt;numeric&gt;
##   AL627309.1       0.971895
##   AL627309.5       0.888672
##   AL627309.4       0.891707
##   AP006222.2       0.999904
##   AL669831.2       0.933916
##          ...            ...
##   AC004556.3       0.856870
##   AC233755.2       0.999904
##   AC233755.1       0.999904
##   AC007325.1       0.975766
##   AC007325.4       0.854162
##   -------
##   seqinfo: 34 sequences from an unspecified genome; no seqlengths</code></pre>
<p>We next import the PeakMatrix. The rownames are already in the format of seqnames:start-end, so rowRanges can be extracted directly from rowData.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="data-preparation.html#cb102-1" tabindex="-1"></a><span class="fu">library</span>(zellkonverter)</span>
<span id="cb102-2"><a href="data-preparation.html#cb102-2" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;http://download.gao-lab.org/GLUE/dataset/10x-Multiome-Pbmc10k-ATAC.h5ad&quot;</span></span>
<span id="cb102-3"><a href="data-preparation.html#cb102-3" tabindex="-1"></a>destfile <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">&quot;.h5ad&quot;</span>)</span>
<span id="cb102-4"><a href="data-preparation.html#cb102-4" tabindex="-1"></a></span>
<span id="cb102-5"><a href="data-preparation.html#cb102-5" tabindex="-1"></a><span class="co"># Download the file</span></span>
<span id="cb102-6"><a href="data-preparation.html#cb102-6" tabindex="-1"></a><span class="fu">download.file</span>(url, destfile, <span class="at">mode =</span> <span class="st">&quot;wb&quot;</span>)</span>
<span id="cb102-7"><a href="data-preparation.html#cb102-7" tabindex="-1"></a></span>
<span id="cb102-8"><a href="data-preparation.html#cb102-8" tabindex="-1"></a>PeakMatrix <span class="ot">&lt;-</span> <span class="fu">readH5AD</span>(destfile)</span>
<span id="cb102-9"><a href="data-preparation.html#cb102-9" tabindex="-1"></a><span class="fu">rowRanges</span>(PeakMatrix) <span class="ot">&lt;-</span> <span class="fu">GRanges</span>(<span class="fu">rowData</span>(PeakMatrix))</span>
<span id="cb102-10"><a href="data-preparation.html#cb102-10" tabindex="-1"></a><span class="fu">rowRanges</span>(PeakMatrix)</span></code></pre></div>
<pre><code>## GRanges object with 107194 ranges and 3 metadata columns:
##                            seqnames        ranges strand | feature_types
##                               &lt;Rle&gt;     &lt;IRanges&gt;  &lt;Rle&gt; |      &lt;factor&gt;
##       chr1:816881-817647       chr1 816881-817647      * |         Peaks
##       chr1:819912-823500       chr1 819912-823500      * |         Peaks
##       chr1:825827-825889       chr1 825827-825889      * |         Peaks
##       chr1:826612-827979       chr1 826612-827979      * |         Peaks
##       chr1:841243-843059       chr1 841243-843059      * |         Peaks
##                      ...        ...           ...    ... .           ...
##   KI270713.1:20444-22615 KI270713.1   20444-22615      * |         Peaks
##   KI270713.1:27118-28927 KI270713.1   27118-28927      * |         Peaks
##   KI270713.1:29485-30706 KI270713.1   29485-30706      * |         Peaks
##   KI270713.1:31511-32072 KI270713.1   31511-32072      * |         Peaks
##   KI270713.1:37129-37638 KI270713.1   37129-37638      * |         Peaks
##                            genome  n_counts
##                          &lt;factor&gt; &lt;numeric&gt;
##       chr1:816881-817647   GRCh38      1025
##       chr1:819912-823500   GRCh38      1384
##       chr1:825827-825889   GRCh38        20
##       chr1:826612-827979   GRCh38      4555
##       chr1:841243-843059   GRCh38       555
##                      ...      ...       ...
##   KI270713.1:20444-22615   GRCh38     12640
##   KI270713.1:27118-28927   GRCh38       533
##   KI270713.1:29485-30706   GRCh38       622
##   KI270713.1:31511-32072   GRCh38       207
##   KI270713.1:37129-37638   GRCh38       388
##   -------
##   seqinfo: 32 sequences from an unspecified genome; no seqlengths</code></pre>
<p>This example SingleCellExperiment dataset is missing the dimensionality reduction information. Users should have been this precalculated. Refer to the section on how to import from <a href="#id_##%20Reading%20directly%20from%20CSV">csv files</a>, or refer to <a href="https://bioconductor.org/books/3.20/OSCA.basic/dimensionality-reduction.html">OSCA</a> book on how to perform dimensionality reduction.</p>
</div>
<div id="starting-from-10x-data-formats" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Starting from 10x data formats<a href="data-preparation.html#starting-from-10x-data-formats" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="reading-from-.h5-file" class="section level3 hasAnchor" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Reading from .h5 file<a href="data-preparation.html#reading-from-.h5-file" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We first download the publicly available PBMC data from 10x Genomics</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="data-preparation.html#cb104-1" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://cf.10xgenomics.com/samples/cell-arc/1.0.0/pbmc_granulocyte_sorted_10k/pbmc_granulocyte_sorted_10k_filtered_feature_bc_matrix.h5&quot;</span></span>
<span id="cb104-2"><a href="data-preparation.html#cb104-2" tabindex="-1"></a>destfile <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">&quot;.h5&quot;</span>)  </span>
<span id="cb104-3"><a href="data-preparation.html#cb104-3" tabindex="-1"></a></span>
<span id="cb104-4"><a href="data-preparation.html#cb104-4" tabindex="-1"></a><span class="co"># Download the file</span></span>
<span id="cb104-5"><a href="data-preparation.html#cb104-5" tabindex="-1"></a><span class="fu">download.file</span>(url, destfile, <span class="at">mode =</span> <span class="st">&quot;wb&quot;</span>)</span></code></pre></div>
<p>This .h5 file contains both genes and peak regions as features, so we read in all the features into a single <code>SingleCellExperiment</code>, and we can specify “Gene Expression” as the main experiment and “Peaks” as the alternative experiment. We then split this single object into 2 separate <code>SingleCellExperiment</code> objects for consistency with other sections.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="data-preparation.html#cb105-1" tabindex="-1"></a><span class="fu">library</span>(DropletUtils)</span>
<span id="cb105-2"><a href="data-preparation.html#cb105-2" tabindex="-1"></a>sce10x <span class="ot">&lt;-</span> <span class="fu">read10xCounts</span>(destfile)</span>
<span id="cb105-3"><a href="data-preparation.html#cb105-3" tabindex="-1"></a></span>
<span id="cb105-4"><a href="data-preparation.html#cb105-4" tabindex="-1"></a>sce10x <span class="ot">&lt;-</span> <span class="fu">splitAltExps</span>(sce10x, <span class="at">f=</span><span class="fu">rowData</span>(sce10x)<span class="sc">$</span>Type, <span class="at">ref=</span><span class="st">&quot;Gene Expression&quot;</span>)</span>
<span id="cb105-5"><a href="data-preparation.html#cb105-5" tabindex="-1"></a></span>
<span id="cb105-6"><a href="data-preparation.html#cb105-6" tabindex="-1"></a>peakMatrix <span class="ot">&lt;-</span> <span class="fu">altExp</span>(sce10x)</span>
<span id="cb105-7"><a href="data-preparation.html#cb105-7" tabindex="-1"></a><span class="fu">rowRanges</span>(peakMatrix) <span class="ot">&lt;-</span> <span class="fu">GRanges</span>(<span class="fu">rownames</span>(peakMatrix))</span>
<span id="cb105-8"><a href="data-preparation.html#cb105-8" tabindex="-1"></a></span>
<span id="cb105-9"><a href="data-preparation.html#cb105-9" tabindex="-1"></a>GeneExpressionMatrix <span class="ot">&lt;-</span> <span class="fu">removeAltExps</span>(sce10x)</span></code></pre></div>
</div>
<div id="reading-directly-from-a-10x-directory" class="section level3 hasAnchor" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> Reading directly from a 10x directory<a href="data-preparation.html#reading-directly-from-a-10x-directory" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can also create a <code>SingleCellExperiment</code> object from a directory containing “matrix.mtx.gz”, “barcodes.tsv.gz” and “features.tsv.gz”</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="data-preparation.html#cb106-1" tabindex="-1"></a><span class="fu">example</span>(write10xCounts)</span></code></pre></div>
<pre><code>## 
## wrt10C&gt; # Mocking up some count data.
## wrt10C&gt; library(Matrix)
## 
## wrt10C&gt; my.counts &lt;- matrix(rpois(1000, lambda=5), ncol=10, nrow=100)
## 
## wrt10C&gt; my.counts &lt;- as(my.counts, &quot;CsparseMatrix&quot;)
## 
## wrt10C&gt; cell.ids &lt;- paste0(&quot;BARCODE-&quot;, seq_len(ncol(my.counts)))
## 
## wrt10C&gt; ngenes &lt;- nrow(my.counts)
## 
## wrt10C&gt; gene.ids &lt;- paste0(&quot;ENSG0000&quot;, seq_len(ngenes))
## 
## wrt10C&gt; gene.symb &lt;- paste0(&quot;GENE&quot;, seq_len(ngenes))
## 
## wrt10C&gt; # Writing this to file:
## wrt10C&gt; tmpdir &lt;- tempfile()
## 
## wrt10C&gt; write10xCounts(tmpdir, my.counts, gene.id=gene.ids, 
## wrt10C+     gene.symbol=gene.symb, barcodes=cell.ids)
## 
## wrt10C&gt; list.files(tmpdir)
## [1] &quot;barcodes.tsv&quot; &quot;genes.tsv&quot;    &quot;matrix.mtx&quot;  
## 
## wrt10C&gt; # Creating a version 3 HDF5 file:
## wrt10C&gt; tmph5 &lt;- tempfile(fileext=&quot;.h5&quot;)
## 
## wrt10C&gt; write10xCounts(tmph5, my.counts, gene.id=gene.ids, 
## wrt10C+     gene.symbol=gene.symb, barcodes=cell.ids, version=&#39;3&#39;)</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="data-preparation.html#cb108-1" tabindex="-1"></a><span class="fu">list.files</span>(tmpdir)</span></code></pre></div>
<pre><code>## [1] &quot;barcodes.tsv&quot; &quot;genes.tsv&quot;    &quot;matrix.mtx&quot;</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="data-preparation.html#cb110-1" tabindex="-1"></a>sce10x <span class="ot">&lt;-</span> <span class="fu">read10xCounts</span>(tmpdir)</span></code></pre></div>
<p>Follow the section on <a href="#id_#%20Starting%20from%20a%20SingleCellExperiment%20object">Constructing a SingleCellExperiment object</a> on how to construct SingleCellExperiment, add colData, rowData and reduced dimensions</p>
</div>
</div>
<div id="reading-directly-from-csv" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Reading directly from CSV<a href="data-preparation.html#reading-directly-from-csv" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If the count matrices are in the form of csv files, read in the count matrix as a sparse matrix and convert it to a <code>dgCMatrix</code>.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="data-preparation.html#cb111-1" tabindex="-1"></a><span class="fu">library</span>(SparseArray)</span>
<span id="cb111-2"><a href="data-preparation.html#cb111-2" tabindex="-1"></a>counts <span class="ot">&lt;-</span> <span class="fu">readSparseCSV</span>(<span class="st">&quot;counts.csv&quot;</span>)</span>
<span id="cb111-3"><a href="data-preparation.html#cb111-3" tabindex="-1"></a>counts <span class="ot">&lt;-</span> <span class="fu">as</span>(counts, <span class="st">&quot;dgCMatrix&quot;</span>)</span></code></pre></div>
<p>Then read in the genomic positions as data.frame and convert it to a <code>GRanges</code>.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="data-preparation.html#cb112-1" tabindex="-1"></a>peak_position <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;peaks.csv&quot;</span>)</span>
<span id="cb112-2"><a href="data-preparation.html#cb112-2" tabindex="-1"></a>peak_position <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(peak_position)</span>
<span id="cb112-3"><a href="data-preparation.html#cb112-3" tabindex="-1"></a>gr <span class="ot">&lt;-</span> GenomicRanges<span class="sc">::</span><span class="fu">makeGRangesFromDataFrame</span>(peak_position)</span></code></pre></div>
<p>Refer to the section on <a href="#id_#%20Constructing%20a%20SingleCellExperiment%20object">Constructing a SingleCellExperiment object</a> on how to construct SingleCellExperiment, add colData, rowData and reduced dimensions.</p>
</div>
<div id="important-points" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> Important points<a href="data-preparation.html#important-points" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Finally, we would like to emphasize again the importance of converting all count matrices to dgCMatrix for speed and compatibility. Both gene expression and peak matrices require <code>rowRanges</code> to indicate genomic positions of target gene position and peak position.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="installation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="basic-workflow-with-multiassayexperiment.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/sce.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Epiregulon documentation.pdf", "Epiregulon documentation.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
