[["refinement.html", "4 Gene regulatory network refinement 4.1 Network pruning 4.2 Annotation with TF motifs 4.3 Annotate with log fold changes", " 4 Gene regulatory network refinement The regulon object constructed in the previous chapter contains all possible links between transcription factors and target genes. As a result, the GRN can be large and may contain some false connections. To refine it, we need to apply filters that retain only those connections supported by our dataset. One such filter has already been applied in the calculateP2G function, which not only searches for regulatory elements within a specified distance from each target gene, but also computes the empirical p-value of the correlation for each target geneâ€“regulatory element pair. Pairs are retained if their p-value is below the threshold specified by the cutoff_sig argument. In this chapter, we introduce three additional filters. The pruneRegulon function filters the GRN based on the co-occurrence of TF gene expression, RE chromatin accessibility and target gene expression. The addMotifScore function annotates regulons for the presence of motifs and filter for regions that contain both ChIP-seq peaks and motifs. Lastly, the addLogFC function calculates changes in gene expression between conditions, so that only target genes showing gene expression changes are selected. 4.1 Network pruning Epiregulon prunes the network by performing tests of independence on the observed number of cells jointly expressing transcription factor (\\(TF\\)), regulatory element (\\(RE\\)) and target gene (\\(TG\\)) vs the expected number of cells if \\(TF\\cdot{RE}\\) and \\(TG\\) are independently expressed. We implement two tests, the binomial test and the chi-square test. In the binomial test, the expected probability is \\(P(TF, RE) \\cdot P(TG)\\), and the number of trials is the total number of cells (or metacells if we set ``), and the observed successes is the number of cells jointly expressing all three elements. In the chi-square test, the expected probability for having all 3 elements active is also \\(P(TF, RE) \\cdot P(TG)\\) and the probability otherwise is \\(1- P(TF, RE) \\cdot P(TG)\\). The observed cell count for the active category is the number of cells jointly expressing all three elements (\\(n_{triple}\\)), and the cell count for the inactive category is \\(n - n_{triple}\\). We calculate cluster-specific p-values if users supply cluster labels. This is useful if we are interested in cluster-specific networks. The pruned regulons can then be used to visualize differential networks for transcription factors of interest. See section on differential networks. pruned.regulon &lt;- pruneRegulon(expMatrix = GeneExpressionMatrix, exp_assay = &quot;normalizedCounts&quot;, peakMatrix = PeakMatrix, peak_assay = &quot;counts&quot;, regulon = regulon, prune_value = &quot;pval&quot;, regulon_cutoff = 0.05, clusters = GeneExpressionMatrix$cell_type) ## pruning network with chi.sq tests using a regulon cutoff of pval&lt;0.05 ## pruning regulons pruned.regulon[,c(&quot;idxATAC&quot;, &quot;target&quot;, &quot;tf&quot;, &quot;corr&quot;, &quot;pval&quot;, &quot;stats&quot;)] ## DataFrame with 3848027 rows and 6 columns ## idxATAC target tf corr pval stats ## &lt;integer&gt; &lt;array&gt; &lt;character&gt; &lt;matrix&gt; &lt;matrix&gt; &lt;matrix&gt; ## 1 135 TNFRSF18 ADNP 0.754387 1.15983e-04:0.00729592:0.9189024:... 14.8568950:7.198631:0.01036657:... ## 2 266 NADK ADNP 0.801851 2.14101e-07:1.00000000:0.9663960:... 26.9014218:0.000000:0.00177484:... ## 3 491 AL139246.5 ADNP -0.492745 8.82635e-01:0.39251604:0.4456618:... 0.0217947:0.731133:0.58166151:... ## 4 769 THAP3 ADNP -0.617348 1.65310e-01:0.45337182:0.0186773:... 1.9249689:0.562208:5.53148270:... ## 5 770 THAP3 ADNP -0.499805 8.72678e-01:0.49647312:0.4028098:... 0.0256825:0.462467:0.69992216:... ## ... ... ... ... ... ... ... ## 3848023 155577 TYMP ZXDC -0.544313 4.48926e-04:0.966239:0.80020467:... 12.3166909:0.00179143:0.0640506:... ## 3848024 155577 ODF3B ZXDC -0.546970 6.00511e-03:0.230097:0.69179190:... 7.5487670:1.44026170:0.1571524:... ## 3848025 155579 ODF3B ZXDC -0.597328 8.91332e-01:0.609131:0.32512183:... 0.0186647:0.26144199:0.9682307:... ## 3848026 157674 GCNA ZXDC 0.725899 4.54914e-02:0.407116:0.24611895:... 4.0003273:0.68720738:1.3452004:... ## 3848027 158053 RADX ZXDC 0.689188 3.72567e-06:0.382620:0.00600021:... 21.4010506:0.76226796:7.5502386:... 4.1.1 Cell aggregation The pruneRegulon function also supports aggregation of cells into metacells, which can be useful when a dataset contains many similar cells with little relevant biological variation. Aggregation reduces noise while preserving the underlying biological signal. The useDim argument specifies the name of the low-dimensional representation of the single-cell data stored in the SingleCellExperiment object. pruned.regulon.aggr &lt;- pruneRegulon(expMatrix = GeneExpressionMatrix, exp_assay = &quot;normalizedCounts&quot;, peakMatrix = PeakMatrix, peak_assay = &quot;counts&quot;, regulon = regulon, prune_value = &quot;pval&quot;, regulon_cutoff = 0.05, clusters = GeneExpressionMatrix$cell_type, aggregateCells = TRUE, useDim = &quot;LSI_RNA&quot;, cellNum = 10) ## pruning network with chi.sq tests using a regulon cutoff of pval&lt;0.05 ## performing pseudobulk using an average of 10 cells ## pruning regulons 4.2 Annotation with TF motifs So far, the gene regulatory network has been constructed exclusively from TF ChIP-seq data. Some users may want to further annotate regulatory elements with motifs. We provide an option to annotate peaks with motifs from the CIS_BP database. If no motifs are present for a particular factor (e.g., for co-factors or chromatin modifiers), NA is returned. If motifs exist for a factor and the regulatory element contains a motif, 1 is returned; if the regulatory element does not contain a motif, 0 is returned. Users can also provide their own motif annotation through the pwms argument. pruned.regulon.motif &lt;- addMotifScore(regulon = pruned.regulon, peaks = rowRanges(PeakMatrix), species = &quot;human&quot;, genome = &quot;hg38&quot;) # filter out the rows where TF motif is not found in the peak region pruned.regulon.motif &lt;- pruned.regulon.motif[which(pruned.regulon.motif$motif == 1),] pruned.regulon.motif[,c(&quot;idxATAC&quot;, &quot;target&quot;, &quot;tf&quot;, &quot;corr&quot;, &quot;p_val_peak_gene&quot;, &quot;pval&quot;, &quot;motif&quot;)] ## DataFrame with 267224 rows and 7 columns ## idxATAC target tf corr p_val_peak_gene pval motif ## &lt;integer&gt; &lt;array&gt; &lt;character&gt; &lt;matrix&gt; &lt;matrix&gt; &lt;matrix&gt; &lt;numeric&gt; ## 1 199 ACAP3 AHR -0.528286 0.03577411 2.44093e-02:0.279181:0.802654:... 1 ## 2 723 TNFRSF25 AHR 0.753414 0.02278260 3.79686e-08:0.874966:0.855158:... 1 ## 3 1100 SLC25A33 AHR -0.652737 0.00883763 2.41562e-08:0.684504:0.103190:... 1 ## 4 2573 NIPAL3 AHR 0.882421 0.00497264 8.93952e-02:0.282032:0.495375:... 1 ## 5 2573 RCAN3AS AHR 0.773188 0.01860059 8.57419e-01:0.677146:0.157380:... 1 ## ... ... ... ... ... ... ... ... ## 267220 157055 CFP ZSCAN16 0.840835 0.00942513 0.009152565:1:0.169688:... 1 ## 267221 33086 GTPBP8 ZSCAN4 0.751812 0.02303227 0.000171032:1:1.000000:... 1 ## 267222 86379 GSTO1 ZSCAN4 -0.687383 0.00510234 0.062041205:1:1.000000:... 1 ## 267223 104541 ZNF84 ZSCAN4 0.711943 0.03174999 0.034884124:1:1.000000:... 1 ## 267224 138281 VAV1 ZSCAN4 -0.592770 0.01915783 0.072809373:1:1.000000:... 1 4.3 Annotate with log fold changes It is sometimes helpful to filter the regulons based on gene expression changes between two conditions. The addLogFC function is a wrapper around scran::findMarkers and adds extra columns of log changes to the regulon DataFrame. The users can specify the reference condition in logFC_ref and conditions for comparison in logFC_condition. If these are not provided, log fold changes are calculated for every condition in the cluster labels against the rest of the conditions. # create logcounts GeneExpressionMatrix &lt;- scuttle::logNormCounts(GeneExpressionMatrix) # add log fold changes which are calculated by taking the difference of the log counts pruned.regulon &lt;- addLogFC(regulon = pruned.regulon, clusters = GeneExpressionMatrix$cell_type, expMatrix = GeneExpressionMatrix, assay.type = &quot;logcounts&quot;, pval.type = &quot;any&quot;, logFC_condition = c(&quot;Memory CD4+ T&quot;, &quot;Naive CD8+ T&quot;), logFC_ref = &quot;Naive CD4+ T&quot;) pruned.regulon[,c(&quot;idxATAC&quot;, &quot;target&quot;, &quot;tf&quot;, &quot;Memory CD4+ T.vs.Naive CD4+ T.logFC&quot;, &quot;Memory CD4+ T.vs.Naive CD4+ T.p.value&quot;)] ## DataFrame with 3848027 rows and 5 columns ## idxATAC target tf Memory CD4+ T.vs.Naive CD4+ T.logFC Memory CD4+ T.vs.Naive CD4+ T.p.value ## &lt;integer&gt; &lt;array&gt; &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt; ## 1 135 TNFRSF18 ADNP 1.06426e-01 -67.97297941 ## 2 266 NADK ADNP 2.67224e-02 -4.75607251 ## 3 491 AL139246.5 ADNP 8.55904e-03 -1.33988061 ## 4 769 THAP3 ADNP -8.52935e-05 -0.00875858 ## 5 770 THAP3 ADNP -8.52935e-05 -0.00875858 ## ... ... ... ... ... ... ## 3848023 155577 TYMP ZXDC 0.09939520 -14.259723 ## 3848024 155577 ODF3B ZXDC 0.01791147 -5.836702 ## 3848025 155579 ODF3B ZXDC 0.01791147 -5.836702 ## 3848026 157674 GCNA ZXDC -0.00189225 -0.180482 ## 3848027 158053 RADX ZXDC 0.05232289 -15.243178 Here we show to use these statistics to filter our regulons. pruned.regulon.filtered &lt;- pruned.regulon[pruned.regulon$&quot;Memory CD4+ T.vs.Naive CD4+ T.FDR&quot; &lt; 0.05 &amp; pruned.regulon$&quot;Memory CD4+ T.vs.Naive CD4+ T.logFC&quot; &gt; 0.3, ] "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
