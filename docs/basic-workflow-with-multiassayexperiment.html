<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Basic workflow with MultiAssayExperiment | Epiregulon documentation</title>
  <meta name="description" content="<p>This book presents the Epiregulon package. We provide the tutorials showing different
scenarions in which the package can be usd to analyse single-cell data.</p>" />
  <meta name="generator" content="bookdown 0.38 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Basic workflow with MultiAssayExperiment | Epiregulon documentation" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This book presents the Epiregulon package. We provide the tutorials showing different
scenarions in which the package can be usd to analyse single-cell data.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Basic workflow with MultiAssayExperiment | Epiregulon documentation" />
  
  <meta name="twitter:description" content="<p>This book presents the Epiregulon package. We provide the tutorials showing different
scenarions in which the package can be usd to analyse single-cell data.</p>" />
  

<meta name="author" content="Xiaosai Yao, Tomasz Włodarczyk" />


<meta name="date" content="2024-03-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="installation.html"/>
<link rel="next" href="advanced-workflow-with-multiassayexperiment.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Epiregulon documentation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>1</b> Installation</a></li>
<li class="chapter" data-level="2" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html"><i class="fa fa-check"></i><b>2</b> Basic workflow with MultiAssayExperiment</a>
<ul>
<li class="chapter" data-level="2.1" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#data-preparation"><i class="fa fa-check"></i><b>2.1</b> Data preparation</a></li>
<li class="chapter" data-level="2.2" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#quick-start"><i class="fa fa-check"></i><b>2.2</b> Quick start</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#retrieve-bulk-tf-chip-seq-binding-sites"><i class="fa fa-check"></i><b>2.2.1</b> Retrieve bulk TF ChIP-seq binding sites</a></li>
<li class="chapter" data-level="2.2.2" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#link-atac-seq-peaks-to-target-genes"><i class="fa fa-check"></i><b>2.2.2</b> Link ATAC-seq peaks to target genes</a></li>
<li class="chapter" data-level="2.2.3" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#add-tf-motif-binding-to-peaks"><i class="fa fa-check"></i><b>2.2.3</b> Add TF motif binding to peaks</a></li>
<li class="chapter" data-level="2.2.4" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#generate-regulons"><i class="fa fa-check"></i><b>2.2.4</b> Generate regulons</a></li>
<li class="chapter" data-level="2.2.5" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#network-pruning-highly-recommended"><i class="fa fa-check"></i><b>2.2.5</b> Network pruning (highly recommended)</a></li>
<li class="chapter" data-level="2.2.6" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#add-weights"><i class="fa fa-check"></i><b>2.2.6</b> Add Weights</a></li>
<li class="chapter" data-level="2.2.7" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#optional-annotate-with-tf-motifs"><i class="fa fa-check"></i><b>2.2.7</b> (Optional) Annotate with TF motifs</a></li>
<li class="chapter" data-level="2.2.8" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#calculate-tf-activity"><i class="fa fa-check"></i><b>2.2.8</b> Calculate TF activity</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="basic-workflow-with-multiassayexperiment.html"><a href="basic-workflow-with-multiassayexperiment.html#session-info"><i class="fa fa-check"></i><b>2.3</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html"><i class="fa fa-check"></i><b>3</b> Advanced workflow with MultiAssayExperiment</a>
<ul>
<li class="chapter" data-level="3.1" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#data-preparation-1"><i class="fa fa-check"></i><b>3.1</b> Data preparation</a></li>
<li class="chapter" data-level="3.2" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#retrieve-bulk-tf-chip-seq-binding-sites-1"><i class="fa fa-check"></i><b>3.2</b> Retrieve bulk TF ChIP-seq binding sites</a></li>
<li class="chapter" data-level="3.3" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#link-atacseq-peaks-to-target-genes"><i class="fa fa-check"></i><b>3.3</b> Link ATACseq peaks to target genes</a></li>
<li class="chapter" data-level="3.4" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#add-tf-motif-binding-to-peaks-1"><i class="fa fa-check"></i><b>3.4</b> Add TF motif binding to peaks</a></li>
<li class="chapter" data-level="3.5" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#generate-regulons-1"><i class="fa fa-check"></i><b>3.5</b> Generate regulons</a></li>
<li class="chapter" data-level="3.6" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#prune-network"><i class="fa fa-check"></i><b>3.6</b> Prune network</a></li>
<li class="chapter" data-level="3.7" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#add-weights-1"><i class="fa fa-check"></i><b>3.7</b> Add Weights</a></li>
<li class="chapter" data-level="3.8" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#calculate-tf-activity-1"><i class="fa fa-check"></i><b>3.8</b> Calculate TF activity</a></li>
<li class="chapter" data-level="3.9" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#differential-tf-activity-test"><i class="fa fa-check"></i><b>3.9</b> Differential TF activity test</a></li>
<li class="chapter" data-level="3.10" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#visualizing-tf-activities"><i class="fa fa-check"></i><b>3.10</b> Visualizing TF activities</a></li>
<li class="chapter" data-level="3.11" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#geneset-enrichment"><i class="fa fa-check"></i><b>3.11</b> Geneset enrichment</a></li>
<li class="chapter" data-level="3.12" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#differential-network-analysis"><i class="fa fa-check"></i><b>3.12</b> Differential Network analysis</a></li>
<li class="chapter" data-level="3.13" data-path="advanced-workflow-with-multiassayexperiment.html"><a href="advanced-workflow-with-multiassayexperiment.html#session-info-1"><i class="fa fa-check"></i><b>3.13</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html"><i class="fa fa-check"></i><b>4</b> ArchR workflow and different weight methods</a>
<ul>
<li class="chapter" data-level="4.1" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#data-preparation-2"><i class="fa fa-check"></i><b>4.1</b> Data preparation</a></li>
<li class="chapter" data-level="4.2" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#load-archr-project"><i class="fa fa-check"></i><b>4.2</b> Load ArchR project</a></li>
<li class="chapter" data-level="4.3" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#retrieve-matrices-from-archr-project"><i class="fa fa-check"></i><b>4.3</b> Retrieve matrices from ArchR project</a></li>
<li class="chapter" data-level="4.4" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#retrieve-bulk-tf-chip-seq-binding-sites-2"><i class="fa fa-check"></i><b>4.4</b> Retrieve bulk TF ChIP-seq binding sites</a></li>
<li class="chapter" data-level="4.5" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#link-atac-seq-peaks-to-target-genes-1"><i class="fa fa-check"></i><b>4.5</b> Link ATAC-seq peaks to target genes</a></li>
<li class="chapter" data-level="4.6" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#add-tf-motif-binding-to-peaks-2"><i class="fa fa-check"></i><b>4.6</b> Add TF motif binding to peaks</a></li>
<li class="chapter" data-level="4.7" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#generate-regulons-2"><i class="fa fa-check"></i><b>4.7</b> Generate regulons</a></li>
<li class="chapter" data-level="4.8" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#optional-annotate-with-tf-motifs-1"><i class="fa fa-check"></i><b>4.8</b> (Optional) Annotate with TF motifs</a></li>
<li class="chapter" data-level="4.9" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#prune-network-1"><i class="fa fa-check"></i><b>4.9</b> Prune network</a></li>
<li class="chapter" data-level="4.10" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#add-weights-2"><i class="fa fa-check"></i><b>4.10</b> Add Weights</a></li>
<li class="chapter" data-level="4.11" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#calculate-tf-activity-2"><i class="fa fa-check"></i><b>4.11</b> Calculate TF activity</a></li>
<li class="chapter" data-level="4.12" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#perform-differential-activity"><i class="fa fa-check"></i><b>4.12</b> Perform differential activity</a></li>
<li class="chapter" data-level="4.13" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#visualize-the-results"><i class="fa fa-check"></i><b>4.13</b> Visualize the results</a></li>
<li class="chapter" data-level="4.14" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#differential-network-analysis-1"><i class="fa fa-check"></i><b>4.14</b> Differential network analysis</a></li>
<li class="chapter" data-level="4.15" data-path="archr-workflow-and-different-weight-methods.html"><a href="archr-workflow-and-different-weight-methods.html#session-info-2"><i class="fa fa-check"></i><b>4.15</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="single-modality-scrna-seq-only.html"><a href="single-modality-scrna-seq-only.html"><i class="fa fa-check"></i><b>5</b> Single modality: scRNA-seq only</a>
<ul>
<li class="chapter" data-level="5.1" data-path="single-modality-scrna-seq-only.html"><a href="single-modality-scrna-seq-only.html#load-regulon"><i class="fa fa-check"></i><b>5.1</b> Load regulon</a></li>
<li class="chapter" data-level="5.2" data-path="single-modality-scrna-seq-only.html"><a href="single-modality-scrna-seq-only.html#load-scrna-seq-data"><i class="fa fa-check"></i><b>5.2</b> Load scRNA-seq data</a></li>
<li class="chapter" data-level="5.3" data-path="single-modality-scrna-seq-only.html"><a href="single-modality-scrna-seq-only.html#calculate-activity"><i class="fa fa-check"></i><b>5.3</b> Calculate activity</a></li>
<li class="chapter" data-level="5.4" data-path="single-modality-scrna-seq-only.html"><a href="single-modality-scrna-seq-only.html#perform-differential-activity-1"><i class="fa fa-check"></i><b>5.4</b> Perform differential activity</a></li>
<li class="chapter" data-level="5.5" data-path="single-modality-scrna-seq-only.html"><a href="single-modality-scrna-seq-only.html#visualize-activity"><i class="fa fa-check"></i><b>5.5</b> Visualize activity</a></li>
<li class="chapter" data-level="5.6" data-path="single-modality-scrna-seq-only.html"><a href="single-modality-scrna-seq-only.html#pathway-enrichment"><i class="fa fa-check"></i><b>5.6</b> Pathway enrichment</a></li>
<li class="chapter" data-level="5.7" data-path="single-modality-scrna-seq-only.html"><a href="single-modality-scrna-seq-only.html#session-info-3"><i class="fa fa-check"></i><b>5.7</b> Session Info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="contact.html"><a href="contact.html"><i class="fa fa-check"></i><b>6</b> Contact</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Epiregulon documentation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="basic-workflow-with-multiassayexperiment" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Basic workflow with MultiAssayExperiment<a href="basic-workflow-with-multiassayexperiment.html#basic-workflow-with-multiassayexperiment" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this chapter, we illustrate the epiregulon workflow starting from data in the form of <code>SingleCellExperiment</code> objects using the correlation weight estimation method.</p>
<p>This tutorial demonstrates the basic functions of <code>epiregulon</code>, using the reprogram-seq dataset which can be downloaded from the <em><a href="https://bioconductor.org/packages/3.19/scMultiome">scMultiome</a></em> package. In this example, prostate cancer cells (LNCaP) were infected in separate wells with viruses encoding 4 transcription factors (NKX2-1, GATA6, FOXA1 and FOXA2) and a positive control (mNeonGreen) before pooling. The identity of the infected transcription factors was tracked through cell hashing (available in the field <code>hash_assignment</code> of the <code>colData</code>) and serves as the ground truth.</p>
<div id="data-preparation" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Data preparation<a href="basic-workflow-with-multiassayexperiment.html#data-preparation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Prior to using <code>epiregulon</code>, single cell preprocessing needs to performed by user’s favorite methods. The following components are required: <br>
1. Peak matrix from scATAC-seq containing the chromatin accessibility information <br>
2. Gene expression matrix from either paired or unpaired scRNA-seq. RNA-seq integration needs to be performed for unpaired dataset. <br>
3. Dimensionality reduction matrix from with either single modalities or joint scRNA-seq and scATAC-seq <br></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="basic-workflow-with-multiassayexperiment.html#cb3-1" tabindex="-1"></a><span class="co"># load the MAE object</span></span>
<span id="cb3-2"><a href="basic-workflow-with-multiassayexperiment.html#cb3-2" tabindex="-1"></a><span class="fu">library</span>(scMultiome)</span></code></pre></div>
<pre><code>## Loading required package: AnnotationHub</code></pre>
<pre><code>## Loading required package: BiocFileCache</code></pre>
<pre><code>## Loading required package: dbplyr</code></pre>
<pre><code>## 
## Attaching package: &#39;AnnotationHub&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:Biobase&#39;:
## 
##     cache</code></pre>
<pre><code>## Loading required package: ExperimentHub</code></pre>
<pre><code>## Loading required package: MultiAssayExperiment</code></pre>
<pre><code>## Loading required package: SingleCellExperiment</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="basic-workflow-with-multiassayexperiment.html#cb12-1" tabindex="-1"></a><span class="fu">library</span>(epiregulon)</span>
<span id="cb12-2"><a href="basic-workflow-with-multiassayexperiment.html#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="basic-workflow-with-multiassayexperiment.html#cb12-3" tabindex="-1"></a>mae <span class="ot">&lt;-</span> scMultiome<span class="sc">::</span><span class="fu">reprogramSeq</span>()</span></code></pre></div>
<pre><code>## snapshotDate(): 2024-03-11</code></pre>
<pre><code>## see ?scMultiome and browseVignettes(&#39;scMultiome&#39;) for documentation</code></pre>
<pre><code>## Warning: Corrupt Cache: resource path
##   See AnnotationHub&#39;s TroubleshootingTheHubs vignette section on corrupt cache
##   cache: /gstore/home/wlodarct/.cache/R/ExperimentHub
##   potential duplicate files: 
##     5e9d57d2f82f_7843
##     72c310f8bfcd_7843
## Continuing with first found cached file</code></pre>
<pre><code>## loading from cache</code></pre>
<pre><code>## Warning: Corrupt Cache: resource path
##   See AnnotationHub&#39;s TroubleshootingTheHubs vignette section on corrupt cache
##   cache: /gstore/home/wlodarct/.cache/R/ExperimentHub
##   potential duplicate files: 
##     5e9d57d2f82f_7843
##     72c310f8bfcd_7843
## Continuing with first found cached file</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="basic-workflow-with-multiassayexperiment.html#cb18-1" tabindex="-1"></a><span class="co"># extract peak matrix</span></span>
<span id="cb18-2"><a href="basic-workflow-with-multiassayexperiment.html#cb18-2" tabindex="-1"></a>PeakMatrix <span class="ot">&lt;-</span> mae[[<span class="st">&quot;PeakMatrix&quot;</span>]]</span>
<span id="cb18-3"><a href="basic-workflow-with-multiassayexperiment.html#cb18-3" tabindex="-1"></a></span>
<span id="cb18-4"><a href="basic-workflow-with-multiassayexperiment.html#cb18-4" tabindex="-1"></a><span class="co"># extract expression matrix</span></span>
<span id="cb18-5"><a href="basic-workflow-with-multiassayexperiment.html#cb18-5" tabindex="-1"></a>GeneExpressionMatrix <span class="ot">&lt;-</span> mae[[<span class="st">&quot;GeneExpressionMatrix&quot;</span>]]</span>
<span id="cb18-6"><a href="basic-workflow-with-multiassayexperiment.html#cb18-6" tabindex="-1"></a><span class="fu">rownames</span>(GeneExpressionMatrix) <span class="ot">&lt;-</span> <span class="fu">rowData</span>(GeneExpressionMatrix)<span class="sc">$</span>name</span>
<span id="cb18-7"><a href="basic-workflow-with-multiassayexperiment.html#cb18-7" tabindex="-1"></a></span>
<span id="cb18-8"><a href="basic-workflow-with-multiassayexperiment.html#cb18-8" tabindex="-1"></a><span class="co"># define the order of hash_assigment</span></span>
<span id="cb18-9"><a href="basic-workflow-with-multiassayexperiment.html#cb18-9" tabindex="-1"></a>GeneExpressionMatrix<span class="sc">$</span>hash_assignment <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">as.character</span>(GeneExpressionMatrix<span class="sc">$</span>hash_assignment),</span>
<span id="cb18-10"><a href="basic-workflow-with-multiassayexperiment.html#cb18-10" tabindex="-1"></a>                                               <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;HTO10_GATA6_UTR&quot;</span>, <span class="st">&quot;HTO2_GATA6_v2&quot;</span>, <span class="st">&quot;HTO8_NKX2.1_UTR&quot;</span>, <span class="st">&quot;HTO3_NKX2.1_v2&quot;</span>, </span>
<span id="cb18-11"><a href="basic-workflow-with-multiassayexperiment.html#cb18-11" tabindex="-1"></a>                                                          <span class="st">&quot;HTO1_FOXA2_v2&quot;</span>, <span class="st">&quot;HTO4_mFOXA1_v2&quot;</span>, <span class="st">&quot;HTO6_hFOXA1_UTR&quot;</span>, <span class="st">&quot;HTO5_NeonG_v2&quot;</span>))</span>
<span id="cb18-12"><a href="basic-workflow-with-multiassayexperiment.html#cb18-12" tabindex="-1"></a><span class="co"># extract dimensional reduction matrix</span></span>
<span id="cb18-13"><a href="basic-workflow-with-multiassayexperiment.html#cb18-13" tabindex="-1"></a>reducedDimMatrix <span class="ot">&lt;-</span> <span class="fu">reducedDim</span>(mae[[<span class="st">&#39;TileMatrix500&#39;</span>]], <span class="st">&quot;LSI_ATAC&quot;</span>)</span>
<span id="cb18-14"><a href="basic-workflow-with-multiassayexperiment.html#cb18-14" tabindex="-1"></a></span>
<span id="cb18-15"><a href="basic-workflow-with-multiassayexperiment.html#cb18-15" tabindex="-1"></a><span class="co"># transfer UMAP_combined from TileMatrix to GeneExpressionMatrix</span></span>
<span id="cb18-16"><a href="basic-workflow-with-multiassayexperiment.html#cb18-16" tabindex="-1"></a><span class="fu">reducedDim</span>(GeneExpressionMatrix, <span class="st">&quot;UMAP_Combined&quot;</span>) <span class="ot">&lt;-</span> <span class="fu">reducedDim</span>(mae[[<span class="st">&#39;TileMatrix500&#39;</span>]], <span class="st">&quot;UMAP_Combined&quot;</span>)</span></code></pre></div>
<p>Visualize singleCellExperiment by UMAP</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="basic-workflow-with-multiassayexperiment.html#cb19-1" tabindex="-1"></a>scater<span class="sc">::</span><span class="fu">plotReducedDim</span>(GeneExpressionMatrix, </span>
<span id="cb19-2"><a href="basic-workflow-with-multiassayexperiment.html#cb19-2" tabindex="-1"></a>                       <span class="at">dimred =</span> <span class="st">&quot;UMAP_Combined&quot;</span>, </span>
<span id="cb19-3"><a href="basic-workflow-with-multiassayexperiment.html#cb19-3" tabindex="-1"></a>                       <span class="at">text_by =</span> <span class="st">&quot;Clusters&quot;</span>, </span>
<span id="cb19-4"><a href="basic-workflow-with-multiassayexperiment.html#cb19-4" tabindex="-1"></a>                       <span class="at">colour_by =</span> <span class="st">&quot;Clusters&quot;</span>)</span></code></pre></div>
<p><img src="Epiregulon-documentation_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="quick-start" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Quick start<a href="basic-workflow-with-multiassayexperiment.html#quick-start" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="retrieve-bulk-tf-chip-seq-binding-sites" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Retrieve bulk TF ChIP-seq binding sites<a href="basic-workflow-with-multiassayexperiment.html#retrieve-bulk-tf-chip-seq-binding-sites" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>First, we retrieve a <code>GRangesList</code> object containing the binding sites of all the transcription factors and co-regulators. These binding sites are derived from bulk ChIP-seq data in the <a href="https://chip-atlas.org/">ChIP-Atlas</a> and <a href="https://www.encodeproject.org/">ENCODE</a> databases. For the same transcription factor, multiple ChIP-seq files from different cell lines or tissues are merged. For further information on how these peaks are derived, please refer to <code>?epiregulon::getTFMotifInfo</code>. Currently, human genomes hg19 and hg38 and mouse mm10 are supported.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="basic-workflow-with-multiassayexperiment.html#cb20-1" tabindex="-1"></a>grl <span class="ot">&lt;-</span> <span class="fu">getTFMotifInfo</span>(<span class="at">genome =</span> <span class="st">&quot;hg38&quot;</span>)</span></code></pre></div>
<pre><code>## snapshotDate(): 2024-03-11</code></pre>
<pre><code>## see ?scMultiome and browseVignettes(&#39;scMultiome&#39;) for documentation</code></pre>
<pre><code>## loading from cache</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="basic-workflow-with-multiassayexperiment.html#cb24-1" tabindex="-1"></a>grl</span></code></pre></div>
<pre><code>## GRangesList object of length 1558:
## $AEBP2
## GRanges object with 2700 ranges and 0 metadata columns:
##          seqnames            ranges strand
##             &lt;Rle&gt;         &lt;IRanges&gt;  &lt;Rle&gt;
##      [1]     chr1        9792-10446      *
##      [2]     chr1     942105-942400      *
##      [3]     chr1     984486-984781      *
##      [4]     chr1   3068932-3069282      *
##      [5]     chr1   3069411-3069950      *
##      ...      ...               ...    ...
##   [2696]     chrY   8465261-8465730      *
##   [2697]     chrY 11721744-11722260      *
##   [2698]     chrY 11747448-11747964      *
##   [2699]     chrY 19302661-19303134      *
##   [2700]     chrY 19985662-19985982      *
##   -------
##   seqinfo: 25 sequences from an unspecified genome; no seqlengths
## 
## ...
## &lt;1557 more elements&gt;</code></pre>
</div>
<div id="link-atac-seq-peaks-to-target-genes" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Link ATAC-seq peaks to target genes<a href="basic-workflow-with-multiassayexperiment.html#link-atac-seq-peaks-to-target-genes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Next, we try to link ATAC-seq peaks to their putative target genes. We assign a peak to a gene within a size window (default ±250kb) if the chromatin accessibility of the peak and expression of the target genes are highly correlated (default threshold 0.5). To compute correlations, we first create cell aggregates by performing k-means clustering on the reduced dimensionality matrix. Then we aggregate the counts of the gene expression and peak matrix and average across the number of cells. Correlations are computed on the averaged gene expression and chromatin accessibility.</p>
<p>If cluster labels are provided, peak-to-gene correlations are computed on all the cells and for each cluster. Peak-to-gene links are retained as long as any of the correlations pass the threshold; the longer list of peak-to-gene links capture both inter- and intra-cluster variations.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="basic-workflow-with-multiassayexperiment.html#cb26-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1010</span>)</span>
<span id="cb26-2"><a href="basic-workflow-with-multiassayexperiment.html#cb26-2" tabindex="-1"></a>p2g <span class="ot">&lt;-</span> <span class="fu">calculateP2G</span>(<span class="at">peakMatrix =</span> PeakMatrix, </span>
<span id="cb26-3"><a href="basic-workflow-with-multiassayexperiment.html#cb26-3" tabindex="-1"></a>                    <span class="at">expMatrix =</span> GeneExpressionMatrix, </span>
<span id="cb26-4"><a href="basic-workflow-with-multiassayexperiment.html#cb26-4" tabindex="-1"></a>                    <span class="at">reducedDim =</span> reducedDimMatrix,</span>
<span id="cb26-5"><a href="basic-workflow-with-multiassayexperiment.html#cb26-5" tabindex="-1"></a>                    <span class="at">exp_assay =</span> <span class="st">&quot;normalizedCounts&quot;</span>,</span>
<span id="cb26-6"><a href="basic-workflow-with-multiassayexperiment.html#cb26-6" tabindex="-1"></a>                    <span class="at">peak_assay =</span> <span class="st">&quot;counts&quot;</span>)</span></code></pre></div>
<pre><code>## Using epiregulon to compute peak to gene links...</code></pre>
<pre><code>## performing k means clustering to form metacells</code></pre>
<pre><code>## Computing correlation</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="basic-workflow-with-multiassayexperiment.html#cb30-1" tabindex="-1"></a>p2g</span></code></pre></div>
<pre><code>## DataFrame with 11342 rows and 8 columns
##         idxATAC         chr     start       end    idxRNA  target Correlation  distance
##       &lt;integer&gt; &lt;character&gt; &lt;integer&gt; &lt;integer&gt; &lt;integer&gt; &lt;array&gt;    &lt;matrix&gt; &lt;integer&gt;
## 1            12        chr1    924540    925040        27 PLEKHN1    0.514480     39440
## 2            18        chr1    943046    943546        19  FAM41C    0.634958     72646
## 3            19        chr1    944445    944945        26  KLHL17    0.527835     13637
## 4            22        chr1    960317    960817        33    AGRN    0.683067     57301
## 5            25        chr1    976232    976732        27 PLEKHN1    0.714727      9551
## ...         ...         ...       ...       ...       ...     ...         ...       ...
## 11338    126565        chrX 154516796 154517296     36406    G6PD    0.531183     27548
## 11339    126566        chrX 154524810 154525310     36395     TAZ    0.528253    113072
## 11340    126571        chrX 154542392 154542892     36401   LAGE3    0.522857     62936
## 11341    126574        chrX 154607299 154607799     36406    G6PD    0.520784     60254
## 11342    126583        chrX 155026775 155027275     36423   BRCC3    0.605565     42143</code></pre>
</div>
<div id="add-tf-motif-binding-to-peaks" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Add TF motif binding to peaks<a href="basic-workflow-with-multiassayexperiment.html#add-tf-motif-binding-to-peaks" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The next step is to add the TF binding information by overlapping regions of the peak matrix with the bulk chip-seq database. The output is a data frame object with three columns:</p>
<ol style="list-style-type: decimal">
<li><code>idxATAC</code> - index of the peak in the peak matrix</li>
<li><code>idxTF</code> - index in the gene expression matrix corresponding to the transcription factor</li>
<li><code>tf</code> - name of the transcription factor</li>
</ol>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="basic-workflow-with-multiassayexperiment.html#cb32-1" tabindex="-1"></a>overlap <span class="ot">&lt;-</span> <span class="fu">addTFMotifInfo</span>(<span class="at">grl =</span> grl, <span class="at">p2g =</span> p2g, <span class="at">peakMatrix =</span> PeakMatrix)</span></code></pre></div>
<pre><code>## Computing overlap...</code></pre>
<pre><code>## Success!</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="basic-workflow-with-multiassayexperiment.html#cb35-1" tabindex="-1"></a><span class="fu">head</span>(overlap)</span></code></pre></div>
<pre><code>##      idxATAC idxTF     tf
## 2312      12     3   AFF4
## 2313      12     8  ARID2
## 2314      12    13   ARNT
## 2315      12    18   ATF3
## 2316      12    23  BACH1
## 2317      12    25 BCL11A</code></pre>
</div>
<div id="generate-regulons" class="section level3 hasAnchor" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> Generate regulons<a href="basic-workflow-with-multiassayexperiment.html#generate-regulons" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A DataFrame, representing the inferred regulons, is then generated. The DataFrame consists of ten columns:</p>
<ol style="list-style-type: decimal">
<li><code>idxATAC</code> - index of the peak in the peak matrix</li>
<li><code>chr</code> - chromosome number</li>
<li><code>start</code> - start position of the peak</li>
<li><code>end</code> - end position of the peak</li>
<li><code>idxRNA</code> - index in the gene expression matrix corresponding to the target gene</li>
<li><code>target</code> - name of the target gene</li>
<li><code>distance</code> - distance between the transcription start site of the target gene and the middle of the peak</li>
<li><code>idxTF</code> - index in the gene expression matrix corresponding to the transcription factor</li>
<li><code>tf</code> - name of the transcription factor</li>
<li><code>corr</code> - correlation between target gene expression and the chromatin accessibility at the peak. if cluster labels are provided,
this field is a matrix with columns names corresponding to correlation across all cells and for each of the clusters.</li>
</ol>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="basic-workflow-with-multiassayexperiment.html#cb37-1" tabindex="-1"></a>regulon <span class="ot">&lt;-</span> <span class="fu">getRegulon</span>(<span class="at">p2g =</span> p2g, <span class="at">overlap =</span> overlap, <span class="at">aggregate =</span> <span class="cn">FALSE</span>)</span>
<span id="cb37-2"><a href="basic-workflow-with-multiassayexperiment.html#cb37-2" tabindex="-1"></a>regulon</span></code></pre></div>
<pre><code>## DataFrame with 1664198 rows and 10 columns
##           idxATAC         chr     start       end    idxRNA      target  distance     idxTF          tf     corr
##         &lt;integer&gt; &lt;character&gt; &lt;integer&gt; &lt;integer&gt; &lt;integer&gt; &lt;character&gt; &lt;integer&gt; &lt;integer&gt; &lt;character&gt; &lt;matrix&gt;
## 1              12        chr1    924540    925040        27     PLEKHN1     39440         3        AFF4  0.51448
## 2              12        chr1    924540    925040        27     PLEKHN1     39440         8       ARID2  0.51448
## 3              12        chr1    924540    925040        27     PLEKHN1     39440        13        ARNT  0.51448
## 4              12        chr1    924540    925040        27     PLEKHN1     39440        18        ATF3  0.51448
## 5              12        chr1    924540    925040        27     PLEKHN1     39440        23       BACH1  0.51448
## ...           ...         ...       ...       ...       ...         ...       ...       ...         ...      ...
## 1664194    126583        chrX 155026775 155027275     36423       BRCC3     42143      1540      ZNF883 0.605565
## 1664195    126583        chrX 155026775 155027275     36423       BRCC3     42143      1541      ZNF891 0.605565
## 1664196    126583        chrX 155026775 155027275     36423       BRCC3     42143      1551     ZSCAN31 0.605565
## 1664197    126583        chrX 155026775 155027275     36423       BRCC3     42143      1557        ZXDB 0.605565
## 1664198    126583        chrX 155026775 155027275     36423       BRCC3     42143      1558        ZXDC 0.605565</code></pre>
</div>
<div id="network-pruning-highly-recommended" class="section level3 hasAnchor" number="2.2.5">
<h3><span class="header-section-number">2.2.5</span> Network pruning (highly recommended)<a href="basic-workflow-with-multiassayexperiment.html#network-pruning-highly-recommended" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Epiregulon prunes the network by performing tests of independence on the observed number of cells jointly expressing transcription factor (TF), regulatory element (RE) and target gene (TG) vs the expected number of cells if TF/RE and TG are independently expressed. The users can choose between two tests, the binomial test and the chi-square test. In the binomial test, the expected probability is P(TF, RE) * P(TG), and the number of trials is the total number of cells, and the observed successes is the number of cells jointly expressing all three elements. In the chi-square test, the expected probability for having all 3 elements active is also P(TF, RE) * P(TG) and the probability otherwise is 1- P(TF, RE) * P(TG). The observed cell count for the category of “active TF” is the number of cells jointly expressing all three elements, and the cell count for the inactive category is n - n_triple.</p>
<p>We calculate cluster-specific p-values if users supply cluster labels. This is useful if we are interested in cluster-specific networks. The pruned regulons can then be used to visualize differential networks for transcription factors of interest.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="basic-workflow-with-multiassayexperiment.html#cb39-1" tabindex="-1"></a>pruned.regulon <span class="ot">&lt;-</span> <span class="fu">pruneRegulon</span>(<span class="at">expMatrix =</span> GeneExpressionMatrix,</span>
<span id="cb39-2"><a href="basic-workflow-with-multiassayexperiment.html#cb39-2" tabindex="-1"></a>                               <span class="at">exp_assay =</span> <span class="st">&quot;normalizedCounts&quot;</span>,</span>
<span id="cb39-3"><a href="basic-workflow-with-multiassayexperiment.html#cb39-3" tabindex="-1"></a>                               <span class="at">peakMatrix =</span> PeakMatrix,</span>
<span id="cb39-4"><a href="basic-workflow-with-multiassayexperiment.html#cb39-4" tabindex="-1"></a>                               <span class="at">peak_assay =</span> <span class="st">&quot;counts&quot;</span>,</span>
<span id="cb39-5"><a href="basic-workflow-with-multiassayexperiment.html#cb39-5" tabindex="-1"></a>                               <span class="at">test =</span> <span class="st">&quot;chi.sq&quot;</span>,</span>
<span id="cb39-6"><a href="basic-workflow-with-multiassayexperiment.html#cb39-6" tabindex="-1"></a>                               regulon[regulon<span class="sc">$</span>tf <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;NKX2-1&quot;</span>,<span class="st">&quot;GATA6&quot;</span>,<span class="st">&quot;FOXA1&quot;</span>,<span class="st">&quot;FOXA2&quot;</span>, <span class="st">&quot;AR&quot;</span>),],</span>
<span id="cb39-7"><a href="basic-workflow-with-multiassayexperiment.html#cb39-7" tabindex="-1"></a>                               <span class="at">clusters =</span> GeneExpressionMatrix<span class="sc">$</span>Clusters,</span>
<span id="cb39-8"><a href="basic-workflow-with-multiassayexperiment.html#cb39-8" tabindex="-1"></a>                               <span class="at">prune_value =</span> <span class="st">&quot;pval&quot;</span>,</span>
<span id="cb39-9"><a href="basic-workflow-with-multiassayexperiment.html#cb39-9" tabindex="-1"></a>                               <span class="at">regulon_cutoff =</span> <span class="fl">0.05</span></span>
<span id="cb39-10"><a href="basic-workflow-with-multiassayexperiment.html#cb39-10" tabindex="-1"></a>                               )</span>
<span id="cb39-11"><a href="basic-workflow-with-multiassayexperiment.html#cb39-11" tabindex="-1"></a></span>
<span id="cb39-12"><a href="basic-workflow-with-multiassayexperiment.html#cb39-12" tabindex="-1"></a>pruned.regulon</span></code></pre></div>
</div>
<div id="add-weights" class="section level3 hasAnchor" number="2.2.6">
<h3><span class="header-section-number">2.2.6</span> Add Weights<a href="basic-workflow-with-multiassayexperiment.html#add-weights" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>While the <code>pruneRegulon</code> function provides statistics on the joint occurrence of TF-RE-TG, we would like to further estimate the strength of regulation. Biologically, this can be interpreted as the magnitude of gene expression changes induced by transcription factor activity. Epiregulon estimates the regulatory potential using one of the three measures: 1) correlation between TF and target gene expression, 2) mutual information between the TF and target gene expression and 3) Wilcoxon test statistics of target gene expression in cells jointly expressing all 3 elements vs cells that do not.</p>
<p>Two of the measures (correlation and Wilcoxon statistics) give both the magnitude and directionality of changes whereas mutual information is always positive. The correlation and mutual information statistics are computed on pseudobulks aggregated by user-supplied cluster labels, whereas the Wilcoxon method groups cells into two categories: 1) the active category of cells jointly expressing TF, RE and TG and 2) the inactive category consisting of the remaining cells.</p>
<p>We calculate cluster-specific weights if users supply cluster labels.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="basic-workflow-with-multiassayexperiment.html#cb40-1" tabindex="-1"></a>regulon.w <span class="ot">&lt;-</span> <span class="fu">addWeights</span>(<span class="at">regulon =</span> pruned.regulon,</span>
<span id="cb40-2"><a href="basic-workflow-with-multiassayexperiment.html#cb40-2" tabindex="-1"></a>                        <span class="at">expMatrix  =</span> GeneExpressionMatrix,</span>
<span id="cb40-3"><a href="basic-workflow-with-multiassayexperiment.html#cb40-3" tabindex="-1"></a>                        <span class="at">exp_assay  =</span> <span class="st">&quot;normalizedCounts&quot;</span>,</span>
<span id="cb40-4"><a href="basic-workflow-with-multiassayexperiment.html#cb40-4" tabindex="-1"></a>                        <span class="at">peakMatrix =</span> PeakMatrix,</span>
<span id="cb40-5"><a href="basic-workflow-with-multiassayexperiment.html#cb40-5" tabindex="-1"></a>                        <span class="at">peak_assay =</span> <span class="st">&quot;counts&quot;</span>,</span>
<span id="cb40-6"><a href="basic-workflow-with-multiassayexperiment.html#cb40-6" tabindex="-1"></a>                        <span class="at">clusters =</span> GeneExpressionMatrix<span class="sc">$</span>Clusters,</span>
<span id="cb40-7"><a href="basic-workflow-with-multiassayexperiment.html#cb40-7" tabindex="-1"></a>                        <span class="at">method =</span> <span class="st">&quot;wilcox&quot;</span>)</span>
<span id="cb40-8"><a href="basic-workflow-with-multiassayexperiment.html#cb40-8" tabindex="-1"></a></span>
<span id="cb40-9"><a href="basic-workflow-with-multiassayexperiment.html#cb40-9" tabindex="-1"></a>regulon.w</span></code></pre></div>
</div>
<div id="optional-annotate-with-tf-motifs" class="section level3 hasAnchor" number="2.2.7">
<h3><span class="header-section-number">2.2.7</span> (Optional) Annotate with TF motifs<a href="basic-workflow-with-multiassayexperiment.html#optional-annotate-with-tf-motifs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>So far the gene regulatory network was constructed from TF ChIP-seq exclusively. Some users would prefer to further annotate regulatory elements with the presence of motifs. We provide an option to annotate peaks with motifs from the Cisbp database. If no motifs are present for this particular factor (as in the case of co-factors or chromatin modifiers), we return NA. If motifs are available for a factor and the RE contains a motif, we return 1. If motifs are available and the RE does not contain a motif, we return 0.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="basic-workflow-with-multiassayexperiment.html#cb41-1" tabindex="-1"></a>regulon.w.motif <span class="ot">&lt;-</span> <span class="fu">addMotifScore</span>(<span class="at">regulon =</span> regulon.w,</span>
<span id="cb41-2"><a href="basic-workflow-with-multiassayexperiment.html#cb41-2" tabindex="-1"></a>                                 <span class="at">peaks =</span> <span class="fu">rowRanges</span>(PeakMatrix),</span>
<span id="cb41-3"><a href="basic-workflow-with-multiassayexperiment.html#cb41-3" tabindex="-1"></a>                                 <span class="at">species =</span> <span class="st">&quot;human&quot;</span>,</span>
<span id="cb41-4"><a href="basic-workflow-with-multiassayexperiment.html#cb41-4" tabindex="-1"></a>                                 <span class="at">genome =</span> <span class="st">&quot;hg38&quot;</span>)</span></code></pre></div>
<pre><code>## annotating peaks with motifs</code></pre>
<pre><code>## snapshotDate(): 2024-03-11</code></pre>
<pre><code>## see ?scMultiome and browseVignettes(&#39;scMultiome&#39;) for documentation</code></pre>
<pre><code>## loading from cache</code></pre>
<pre><code>## </code></pre>
<pre><code>## 
## Attaching package: &#39;XVector&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:plyr&#39;:
## 
##     compact</code></pre>
<pre><code>## 
## Attaching package: &#39;Biostrings&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:grid&#39;:
## 
##     pattern</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     strsplit</code></pre>
<pre><code>## 
## Attaching package: &#39;rtracklayer&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:BiocIO&#39;:
## 
##     FileForFormat</code></pre>
<pre><code>## The following object is masked from &#39;package:AnnotationHub&#39;:
## 
##     hubUrl</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="basic-workflow-with-multiassayexperiment.html#cb55-1" tabindex="-1"></a><span class="co"># if desired, set weight to 0 if no motif is found</span></span>
<span id="cb55-2"><a href="basic-workflow-with-multiassayexperiment.html#cb55-2" tabindex="-1"></a>regulon.w.motif<span class="sc">$</span>weight[regulon.w.motif<span class="sc">$</span>motif <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb55-3"><a href="basic-workflow-with-multiassayexperiment.html#cb55-3" tabindex="-1"></a></span>
<span id="cb55-4"><a href="basic-workflow-with-multiassayexperiment.html#cb55-4" tabindex="-1"></a>regulon.w.motif</span></code></pre></div>
<pre><code>## DataFrame with 5183 rows and 15 columns
##        idxATAC         chr     start       end    idxRNA      target  distance     idxTF          tf     corr
##      &lt;integer&gt; &lt;character&gt; &lt;integer&gt; &lt;integer&gt; &lt;integer&gt; &lt;character&gt; &lt;integer&gt; &lt;integer&gt; &lt;character&gt; &lt;matrix&gt;
## 1           12        chr1    924540    925040        27     PLEKHN1     39440       490          AR 0.514480
## 2           22        chr1    960317    960817        33        AGRN     57301       490          AR 0.683067
## 3           25        chr1    976232    976732        27     PLEKHN1      9551       490          AR 0.714727
## 4           28        chr1    999317    999817        27     PLEKHN1     32636       490          AR 0.666428
## 5           36        chr1   1019834   1020334        37    C1orf159     69838       490          AR 0.507988
## ...        ...         ...       ...       ...       ...         ...       ...       ...         ...      ...
## 5179    121777        chr9  97632816  97633316     34691         XPA     62039       807      NKX2-1 0.512977
## 5180    122254        chr9 108991440 108991940     34784     CTNNAL1     27686       807      NKX2-1 0.535211
## 5181    122461        chr9 113174265 113174765     34825     SLC31A1     44777       807      NKX2-1 0.693885
## 5182    122486        chr9 113410132 113410632     34829       WDR31     69664       807      NKX2-1 0.687963
## 5183    125664        chrX 103373520 103374020     35972      TCEAL8    118166       807      NKX2-1 0.636336
##                             pval                   stats                qval    weight     motif
##                         &lt;matrix&gt;                &lt;matrix&gt;            &lt;matrix&gt;  &lt;matrix&gt; &lt;numeric&gt;
## 1    0.1100599:0.000116038:1:... 2.55336:14.856005:0:...           1:1:1:... 0:0:0:...         0
## 2    0.0442620:0.507661630:1:... 4.04654: 0.438884:0:...           1:1:1:... 0:0:0:...         0
## 3    0.1684463:0.018871908:1:... 1.89672: 5.513346:0:...           1:1:1:... 0:0:0:...         0
## 4    0.0171580:0.015354703:1:... 5.68014: 5.875306:0:...           1:1:1:... 0:0:0:...         0
## 5    0.0111761:0.105168717:1:... 6.43710: 2.625359:0:...           1:1:1:... 0:0:0:...         0
## ...                          ...                     ...                 ...       ...       ...
## 5179         8.54038e-02:1:1:...         2.95894:0:0:... 1.000000000:1:1:... 0:0:0:...         0
## 5180         1.30998e-02:1:1:...         6.15558:0:0:... 1.000000000:1:1:... 0:0:0:...         0
## 5181         4.51202e-02:1:1:...         4.01414:0:0:... 1.000000000:1:1:... 0:0:0:...         0
## 5182         8.35430e-09:1:1:...        33.19084:0:0:... 0.000220721:1:1:... 0:0:0:...         0
## 5183         5.64410e-06:1:1:...        20.60525:0:0:... 0.147960211:1:1:... 0:0:0:...         0</code></pre>
</div>
<div id="calculate-tf-activity" class="section level3 hasAnchor" number="2.2.8">
<h3><span class="header-section-number">2.2.8</span> Calculate TF activity<a href="basic-workflow-with-multiassayexperiment.html#calculate-tf-activity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Finally, the activities for a specific TF in each cell are computed by averaging expressions of target genes linked to the TF weighted by the test statistics of choice, chosen from either correlation, mutual information or the Wilcoxon test statistics.
<span class="math display">\[y=\frac{1}{n}\sum_{i=1}^{n} x_i * weights_i\]</span>
where <span class="math inline">\(y\)</span> is the activity of a TF for a cell,
<span class="math inline">\(n\)</span> is the total number of targets for a TF,
<span class="math inline">\(x_i\)</span> is the log count expression of target <span class="math inline">\(i\)</span> where <span class="math inline">\(i\)</span> in {1,2,…,n} and
<span class="math inline">\(weights_i\)</span> is the weight of TF - target <span class="math inline">\(i\)</span></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="basic-workflow-with-multiassayexperiment.html#cb57-1" tabindex="-1"></a>score.combine <span class="ot">&lt;-</span> <span class="fu">calculateActivity</span>(<span class="at">expMatrix =</span> GeneExpressionMatrix,</span>
<span id="cb57-2"><a href="basic-workflow-with-multiassayexperiment.html#cb57-2" tabindex="-1"></a>                                   <span class="at">regulon =</span> regulon.w, </span>
<span id="cb57-3"><a href="basic-workflow-with-multiassayexperiment.html#cb57-3" tabindex="-1"></a>                                   <span class="at">mode =</span> <span class="st">&quot;weight&quot;</span>, </span>
<span id="cb57-4"><a href="basic-workflow-with-multiassayexperiment.html#cb57-4" tabindex="-1"></a>                                   <span class="at">method =</span> <span class="st">&quot;weightedMean&quot;</span>, </span>
<span id="cb57-5"><a href="basic-workflow-with-multiassayexperiment.html#cb57-5" tabindex="-1"></a>                                   <span class="at">exp_assay =</span> <span class="st">&quot;normalizedCounts&quot;</span>,</span>
<span id="cb57-6"><a href="basic-workflow-with-multiassayexperiment.html#cb57-6" tabindex="-1"></a>                                   <span class="at">normalize =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## calculating TF activity from regulon using weightedmean</code></pre>
<pre><code>## Warning in calculateActivity(expMatrix = GeneExpressionMatrix, regulon = regulon.w, : The weight column contains multiple
## subcolumns but no cluster information was provided. Using first column to compute activity...</code></pre>
<pre><code>## aggregating regulons...</code></pre>
<pre><code>## creating weight matrix...</code></pre>
<pre><code>## calculating activity scores...</code></pre>
<pre><code>## normalize by the number of targets...</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="basic-workflow-with-multiassayexperiment.html#cb64-1" tabindex="-1"></a>score.combine[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>## 5 x 5 sparse Matrix of class &quot;dgCMatrix&quot;
##        reprogram#TTAGGAACAAGGTACG-1 reprogram#GAGCGGTCAACCTGGT-1 reprogram#TTATAGCCACCCTCAC-1 reprogram#TGGTGATTCCTGTTCA-1
## AR                       0.02437416                   0.03482558                   0.01920813                  0.021308518
## FOXA1                    0.01989094                   0.02416234                   0.01231442                  0.012557325
## FOXA2                    0.01003670                   0.02380898                   0.01132239                  0.016970189
## GATA6                    0.02399254                   0.11312831                   0.01405688                  0.018020495
## NKX2-1                   0.04739232                   0.03213549                   0.01199183                  0.009208308
##        reprogram#TCGGTTCTCACTAGGT-1
## AR                       0.02496032
## FOXA1                    0.02073854
## FOXA2                    0.01383926
## GATA6                    0.02046804
## NKX2-1                   0.04729744</code></pre>
</div>
</div>
<div id="session-info" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Session Info<a href="basic-workflow-with-multiassayexperiment.html#session-info" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="basic-workflow-with-multiassayexperiment.html#cb66-1" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R Under development (unstable) (2023-12-04 r85659)
## Platform: x86_64-pc-linux-gnu
## Running under: Ubuntu 18.04.6 LTS
## 
## Matrix products: default
## BLAS:   /usr/local/lib/R/lib/libRblas.so 
## LAPACK: /usr/local/lib/R/lib/libRlapack.so;  LAPACK version 3.11.0
## 
## Random number generation:
##  RNG:     L&#39;Ecuyer-CMRG 
##  Normal:  Inversion 
##  Sample:  Rejection 
##  
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C             LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## time zone: Etc/UTC
## tzcode source: system (glibc)
## 
## attached base packages:
##  [1] parallel  stats4    grid      stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] BSgenome.Hsapiens.UCSC.hg38_1.4.5 BSgenome_1.71.2                   rtracklayer_1.63.1               
##  [4] BiocIO_1.13.0                     Biostrings_2.71.4                 XVector_0.43.1                   
##  [7] epiregulon_0.99.5                 scMultiome_1.3.0                  SingleCellExperiment_1.25.0      
## [10] MultiAssayExperiment_1.29.1       ExperimentHub_2.11.1              AnnotationHub_3.11.1             
## [13] BiocFileCache_2.11.1              dbplyr_2.4.0                      BiocStyle_2.31.0                 
## [16] rhdf5_2.47.6                      SummarizedExperiment_1.33.3       Biobase_2.63.0                   
## [19] RcppArmadillo_0.12.8.1.0          Rcpp_1.0.12                       Matrix_1.6-4                     
## [22] GenomicRanges_1.55.3              GenomeInfoDb_1.39.9               IRanges_2.37.1                   
## [25] S4Vectors_0.41.4                  BiocGenerics_0.49.1               sparseMatrixStats_1.15.0         
## [28] MatrixGenerics_1.15.0             matrixStats_1.2.0                 data.table_1.15.2                
## [31] stringr_1.5.1                     plyr_1.8.9                        magrittr_2.0.3                   
## [34] ggplot2_3.5.0                     gtable_0.3.4                      gtools_3.9.5                     
## [37] gridExtra_2.3                     devtools_2.4.5                    usethis_2.2.3                    
## [40] ArchR_1.0.3                      
## 
## loaded via a namespace (and not attached):
##   [1] later_1.3.2                 bitops_1.0-7                filelock_1.0.3              R.oo_1.26.0                
##   [5] tibble_3.2.1                graph_1.81.0                DirichletMultinomial_1.45.0 XML_3.99-0.16.1            
##   [9] lifecycle_1.0.4             edgeR_4.1.18                lattice_0.22-5              backports_1.4.1            
##  [13] limma_3.59.6                sass_0.4.9                  rmarkdown_2.26              jquerylib_0.1.4            
##  [17] yaml_2.3.8                  remotes_2.5.0               metapod_1.11.1              httpuv_1.6.14              
##  [21] sessioninfo_1.2.2           pkgbuild_1.4.4              CNEr_1.39.0                 cowplot_1.1.3              
##  [25] DBI_1.2.2                   abind_1.4-5                 pkgload_1.3.4               zlibbioc_1.49.3            
##  [29] R.utils_2.12.3              purrr_1.0.2                 RCurl_1.98-1.14             pracma_2.4.4               
##  [33] rappdirs_0.3.3              GenomeInfoDbData_1.2.11     ggrepel_0.9.5               irlba_2.3.5.1              
##  [37] seqLogo_1.69.0              annotate_1.81.2             dqrng_0.3.2                 DelayedMatrixStats_1.25.1  
##  [41] codetools_0.2-19            DelayedArray_0.29.9         scuttle_1.13.1              tidyselect_1.2.1           
##  [45] farver_2.1.1                ScaledMatrix_1.11.1         viridis_0.6.5               GenomicAlignments_1.39.4   
##  [49] jsonlite_1.8.8              BiocNeighbors_1.21.2        ellipsis_0.3.2              motifmatchr_1.25.0         
##  [53] scater_1.31.2               tools_4.4.0                 TFMPvalue_0.0.9             glue_1.7.0                 
##  [57] SparseArray_1.3.4           xfun_0.42                   dplyr_1.1.4                 HDF5Array_1.31.6           
##  [61] withr_3.0.0                 BiocManager_1.30.22         fastmap_1.1.1               rhdf5filters_1.15.4        
##  [65] bluster_1.13.0              fansi_1.0.6                 caTools_1.18.2              digest_0.6.35              
##  [69] rsvd_1.0.5                  R6_2.5.1                    mime_0.12                   colorspace_2.1-0           
##  [73] GO.db_3.18.0                Cairo_1.6-2                 poweRlaw_0.80.0             RSQLite_2.3.5              
##  [77] R.methodsS3_1.8.2           utf8_1.2.4                  generics_0.1.3              httr_1.4.7                 
##  [81] htmlwidgets_1.6.4           S4Arrays_1.3.6              TFBSTools_1.41.0            pkgconfig_2.0.3            
##  [85] blob_1.2.4                  htmltools_0.5.7             profvis_0.3.8               bookdown_0.38              
##  [89] GSEABase_1.65.1             scales_1.3.0                png_0.1-8                   scran_1.31.3               
##  [93] knitr_1.45                  rstudioapi_0.15.0           reshape2_1.4.4              tzdb_0.4.0                 
##  [97] rjson_0.2.21                checkmate_2.3.1             curl_5.2.1                  cachem_1.0.8               
## [101] BiocVersion_3.19.1          miniUI_0.1.1.1              vipor_0.4.7                 AnnotationDbi_1.65.2       
## [105] restfulr_0.0.15             pillar_1.9.0                vctrs_0.6.5                 urlchecker_1.0.1           
## [109] promises_1.2.1              BiocSingular_1.19.0         beachmat_2.19.1             xtable_1.8-4               
## [113] cluster_2.1.6               beeswarm_0.4.0              Rgraphviz_2.47.0            evaluate_0.23              
## [117] KEGGgraph_1.63.0            readr_2.1.5                 Rsamtools_2.19.3            locfit_1.5-9.9             
## [121] cli_3.6.2                   compiler_4.4.0              rlang_1.1.3                 crayon_1.5.2               
## [125] labeling_0.4.3              fs_1.6.3                    ggbeeswarm_0.7.2            stringi_1.8.3              
## [129] viridisLite_0.4.2           BiocParallel_1.37.1         munsell_0.5.0               hms_1.1.3                  
## [133] bit64_4.0.5                 Rhdf5lib_1.25.1             statmod_1.5.0               KEGGREST_1.43.0            
## [137] shiny_1.8.0                 highr_0.10                  igraph_2.0.3                memoise_2.0.1              
## [141] bslib_0.6.1                 bit_4.0.5                   EnrichmentBrowser_2.33.1</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="installation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="advanced-workflow-with-multiassayexperiment.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/multiome.mae.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Epiregulon documentation.pdf", "Epiregulon documentation.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
